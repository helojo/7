<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修用GDB调试程序（一）' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>用GDB调试程序（一）</center></div><div class='banquan'>原文出处:本文由博客园博主苏州小李子提供。<br/>
原文连接:https://www.cnblogs.com/gavin-world/p/11137804.html</div><br>
    <p>用GDB调试程序</p>
<p>GDB概述<br />&mdash;&mdash;&mdash;&mdash;</p>
<p>GDB是GNU开源组织发布的一个强大的UNIX下的程序调试工具。或许，各位比较喜欢那种图形界面方式的，像VC、BCB等IDE的调试，但如果你是在UNIX平台下做软件，你会发现GDB这个调试工具有比VC、BCB的图形化调试器更强大的功能。所谓&ldquo;寸有所长，尺有所短&rdquo;就是这个道理。</p>
<p>一般来说，GDB主要帮忙你完成下面四个方面的功能：</p>
<p>&nbsp;&nbsp;&nbsp; 1、启动你的程序，可以按照你的自定义的要求随心所欲的运行程序。<br />&nbsp;&nbsp;&nbsp; 2、可让被调试的程序在你所指定的调置的断点处停住。（断点可以是条件表达式）<br />&nbsp;&nbsp;&nbsp; 3、当程序被停住时，可以检查此时你的程序中所发生的事。<br />&nbsp;&nbsp;&nbsp; 4、动态的改变你程序的执行环境。</p>
<p>从上面看来，GDB和一般的调试工具没有什么两样，基本上也是完成这些功能，不过在细节上，你会发现GDB这个调试工具的强大，大家可能比较习惯了图形化的调试工具，但有时候，命令行的调试工具却有着图形化工具所不能完成的功能。让我们一一看来。</p>
<p><br />一个调试示例<br />&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</p>
<p>源程序：tst.c</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; 1 #include &lt;stdio.h&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp; 2<br />&nbsp;&nbsp;&nbsp;&nbsp; 3 int func(int n)<br />&nbsp;&nbsp;&nbsp;&nbsp; 4 {<br />&nbsp;&nbsp;&nbsp;&nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int sum=0,i;<br />&nbsp;&nbsp;&nbsp;&nbsp; 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(i=0; i&lt;n; i++)<br />&nbsp;&nbsp;&nbsp;&nbsp; 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum+=i;<br />&nbsp;&nbsp;&nbsp;&nbsp; 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sum;<br />&nbsp;&nbsp;&nbsp; 11 }<br />&nbsp;&nbsp;&nbsp; 12<br />&nbsp;&nbsp;&nbsp; 13<br />&nbsp;&nbsp;&nbsp; 14 main()<br />&nbsp;&nbsp;&nbsp; 15 {<br />&nbsp;&nbsp;&nbsp; 16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int i;<br />&nbsp;&nbsp;&nbsp; 17&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; long result = 0;<br />&nbsp;&nbsp;&nbsp; 18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(i=1; i&lt;=100; i++)<br />&nbsp;&nbsp;&nbsp; 19&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result += i;<br />&nbsp;&nbsp;&nbsp; 21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; 22<br />&nbsp;&nbsp;&nbsp; 23&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf("result[1-100] = %d /n", result );<br />&nbsp;&nbsp;&nbsp; 24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf("result[1-250] = %d /n", func(250) );<br />&nbsp;&nbsp;&nbsp; 25 }</p>
<p>编译生成执行文件：（Linux下）<br />&nbsp;&nbsp;&nbsp; hchen/test&gt; cc -g tst.c -o tst</p>
<p>使用GDB调试：</p>
<p>hchen/test&gt; gdb tst&nbsp; &lt;---------- 启动GDB<br />GNU gdb 5.1.1<br />Copyright 2002 Free Software Foundation, Inc.<br />GDB is free software, covered by the GNU General Public License, and you are<br />welcome to change it and/or distribute copies of it under certain conditions.<br />Type "show copying" to see the conditions.<br />There is absolutely no warranty for GDB.&nbsp; Type "show warranty" for details.<br />This GDB was configured as "i386-suse-linux"...<br />(gdb) l&nbsp;&nbsp;&nbsp;&nbsp; &lt;-------------------- l命令相当于list，从第一行开始例出原码。<br />1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #include &lt;stdio.h&gt;<br />2<br />3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int func(int n)<br />4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int sum=0,i;<br />6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(i=0; i&lt;n; i++)<br />7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum+=i;<br />9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return sum;<br />(gdb)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;-------------------- 直接回车表示，重复上一次命令<br />11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />12<br />13<br />14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main()<br />15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int i;<br />17&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; long result = 0;<br />18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(i=1; i&lt;=100; i++)<br />19&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result += i;&nbsp;&nbsp;&nbsp; <br />(gdb) break 16&nbsp;&nbsp;&nbsp; &lt;-------------------- 设置断点，在源程序第16行处。<br />Breakpoint 1 at 0x8048496: file tst.c, line 16.<br />(gdb) break func&nbsp; &lt;-------------------- 设置断点，在函数func()入口处。<br />Breakpoint 2 at 0x8048456: file tst.c, line 5.<br />(gdb) info break&nbsp; &lt;-------------------- 查看断点信息。<br />Num Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Disp Enb Address&nbsp;&nbsp;&nbsp; What<br />1&nbsp;&nbsp; breakpoint&nbsp;&nbsp;&nbsp;&nbsp; keep y&nbsp;&nbsp; 0x08048496 in main at tst.c:16<br />2&nbsp;&nbsp; breakpoint&nbsp;&nbsp;&nbsp;&nbsp; keep y&nbsp;&nbsp; 0x08048456 in func at tst.c:5<br />(gdb) r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;--------------------- 运行程序，run命令简写<br />Starting program: /home/hchen/test/tst</p>
<p>Breakpoint 1, main () at tst.c:17&nbsp;&nbsp;&nbsp; &lt;---------- 在断点处停住。<br />17&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; long result = 0;<br />(gdb) n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;--------------------- 单条语句执行，next命令简写。<br />18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(i=1; i&lt;=100; i++)<br />(gdb) n<br />20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result += i;<br />(gdb) n<br />18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(i=1; i&lt;=100; i++)<br />(gdb) n<br />20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result += i;<br />(gdb) c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;--------------------- 继续运行程序，continue命令简写。<br />Continuing.<br />result[1-100] = 5050&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;----------程序输出。</p>
<p>Breakpoint 2, func (n=250) at tst.c:5<br />5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int sum=0,i;<br />(gdb) n<br />6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(i=1; i&lt;=n; i++)<br />(gdb) p i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;--------------------- 打印变量i的值，print命令简写。<br />$1 = 134513808<br />(gdb) n<br />8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum+=i;<br />(gdb) n<br />6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(i=1; i&lt;=n; i++)<br />(gdb) p sum<br />$2 = 1<br />(gdb) n<br />8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum+=i;<br />(gdb) p i<br />$3 = 2<br />(gdb) n<br />6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(i=1; i&lt;=n; i++)<br />(gdb) p sum<br />$4 = 3<br />(gdb) bt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;--------------------- 查看函数堆栈。<br />#0&nbsp; func (n=250) at tst.c:5<br />#1&nbsp; 0x080484e4 in main () at tst.c:24<br />#2&nbsp; 0x400409ed in __libc_start_main () from /lib/libc.so.6<br />(gdb) finish&nbsp;&nbsp;&nbsp; &lt;--------------------- 退出函数。<br />Run till exit from #0&nbsp; func (n=250) at tst.c:5<br />0x080484e4 in main () at tst.c:24<br />24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf("result[1-250] = %d /n", func(250) );<br />Value returned is $6 = 31375<br />(gdb) c&nbsp;&nbsp;&nbsp;&nbsp; &lt;--------------------- 继续运行。<br />Continuing.<br />result[1-250] = 31375&nbsp;&nbsp;&nbsp; &lt;----------程序输出。</p>
<p>Program exited with code 027. &lt;--------程序退出，调试结束。<br />(gdb) q&nbsp;&nbsp;&nbsp;&nbsp; &lt;--------------------- 退出gdb。<br />hchen/test&gt;</p>
<p>好了，有了以上的感性认识，还是让我们来系统地认识一下gdb吧。</p>
<p>&nbsp;</p>
<p><br />使用GDB<br />&mdash;&mdash;&mdash;&mdash;</p>
<p>一般来说GDB主要调试的是C/C++的程序。要调试C/C++的程序，首先在编译时，我们必须要把调试信息加到可执行文件中。使用编译器（cc/gcc/g++）的 -g 参数可以做到这一点。如：</p>
<p>&nbsp;&nbsp;&nbsp; &gt; cc -g hello.c -o hello<br />&nbsp;&nbsp;&nbsp; &gt; g++ -g hello.cpp -o hello</p>
<p>如果没有-g，你将看不见程序的函数名、变量名，所代替的全是运行时的内存地址。当你用-g把调试信息加入之后，并成功编译目标代码以后，让我们来看看如何用gdb来调试他。</p>
<p>启动GDB的方法有以下几种：</p>
<p>&nbsp;&nbsp;&nbsp; 1、gdb &lt;program&gt; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; program也就是你的执行文件，一般在当然目录下。</p>
<p>&nbsp;&nbsp;&nbsp; 2、gdb &lt;program&gt; core<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 用gdb同时调试一个运行程序和core文件，core是程序非法执行后core dump后产生的文件。</p>
<p>&nbsp;&nbsp;&nbsp; 3、gdb &lt;program&gt; &lt;PID&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 如果你的程序是一个服务程序，那么你可以指定这个服务程序运行时的进程ID。gdb会自动attach上去，并调试他。program应该在PATH环境变量中搜索得到。</p>
<p>&nbsp;</p>
<p>GDB启动时，可以加上一些GDB的启动开关，详细的开关可以用gdb -help查看。我在下面只例举一些比较常用的参数：</p>
<p>&nbsp;&nbsp;&nbsp; -symbols &lt;file&gt; <br />&nbsp;&nbsp;&nbsp; -s &lt;file&gt; <br />&nbsp;&nbsp;&nbsp; 从指定文件中读取符号表。</p>
<p>&nbsp;&nbsp;&nbsp; -se file <br />&nbsp;&nbsp;&nbsp; 从指定文件中读取符号表信息，并把他用在可执行文件中。</p>
<p>&nbsp;&nbsp;&nbsp; -core &lt;file&gt;<br />&nbsp;&nbsp;&nbsp; -c &lt;file&gt; <br />&nbsp;&nbsp;&nbsp; 调试时core dump的core文件。</p>
<p>&nbsp;&nbsp;&nbsp; -directory &lt;directory&gt;<br />&nbsp;&nbsp;&nbsp; -d &lt;directory&gt;<br />&nbsp;&nbsp;&nbsp; 加入一个源文件的搜索路径。默认搜索路径是环境变量中PATH所定义的路径。<br />--------------------- <br />作者：haoel <br />来源：CSDN <br />原文：https://blog.csdn.net/haoel/article/details/2879 <br /><br /></p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>