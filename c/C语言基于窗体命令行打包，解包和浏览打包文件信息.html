<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修C语言基于窗体命令行打包，解包和浏览打包文件信息' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>C语言基于窗体命令行打包，解包和浏览打包文件信息</center></div><div class='banquan'>原文出处:本文由博客园博主luckydogboy提供。<br/>
原文连接:https://www.cnblogs.com/luckydogboy/p/11700380.html</div><br>
    <div><br />#include&lt;stdio.h&gt;<br />#include&lt;stdlib.h&gt;<br />#include&lt;string.h&gt;<br />#include&lt;windows.h&gt;<br />#include&lt;io.h&gt;<br />#include&lt;iostream&gt;<br />#include&lt;string&gt;
<div><br />using namespace std;<br />&nbsp;int count=0;
<div>&nbsp;typedef struct Note{<br />&nbsp;&nbsp;char path[50];<br />&nbsp;&nbsp;struct Note *next;<br />&nbsp;}Note,*Lnote;
<div>&nbsp;typedef struct Node {<br />&nbsp;&nbsp;char name[20];<br />&nbsp;&nbsp;unsigned int size;
<div>&nbsp;&nbsp;struct Node *next;&nbsp;&nbsp;&nbsp; <br />&nbsp;}Node,*List;<br />&nbsp;<br />&nbsp;List creat(void);<br />&nbsp;void add(List *head,char *Tname,int Tsize);<br />&nbsp;void bwrite(char *fn); <br />&nbsp;void file_in(char *Path_r,char *Path_w);<br />&nbsp;void unzip(char *Path_file,char *Path_out);<br />&nbsp;void lookthepack(char *path);<br />&nbsp;Lnote Tcreat(void);<br />&nbsp;void Tadd(Lnote *Thead,char *Path);<br />&nbsp;void zip(char *ar1,char *ar2);&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;void lookthepack(char *path){<br />&nbsp;&nbsp;int i,j;<br />&nbsp;&nbsp;Node p;<br />&nbsp;&nbsp;FILE *fp;<br />&nbsp;&nbsp;&nbsp;if((fp=fopen(path,"rb"))==NULL){<br />&nbsp;&nbsp;&nbsp;printf("Can't open %s\n",path);<br />&nbsp;&nbsp;&nbsp;&nbsp;exit(1);<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;fseek(fp,0L,SEEK_SET);&nbsp;<br />&nbsp;&nbsp;&nbsp;rewind(fp);<br />&nbsp;&nbsp;&nbsp;fread(&amp;j,sizeof(j),1,fp);<br />&nbsp;&nbsp;&nbsp;printf("打包文件总数为：&nbsp; %d\n",j);<br />&nbsp;&nbsp;&nbsp;for(i=0;i&lt;j;i++){<br />&nbsp;&nbsp;&nbsp;&nbsp;fread(&amp;p,sizeof(p),1,fp);<br />&nbsp;&nbsp;&nbsp;&nbsp;printf("%s\n",p.name);<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;}<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;void zip(char *ar1,char *ar2){<br />&nbsp;&nbsp;&nbsp;char check;<br />&nbsp;&nbsp;&nbsp;int l;<br />&nbsp;&nbsp;&nbsp;List head=creat();<br />&nbsp;&nbsp;&nbsp;Lnote Thead=Tcreat();<br />&nbsp;&nbsp; &nbsp;&nbsp;long Handle;<br />&nbsp;&nbsp;&nbsp;struct _finddata_t FileInfo;<br />&nbsp;&nbsp;&nbsp;&nbsp;l=strlen(ar1);<br />&nbsp;&nbsp;&nbsp;for(;l&gt;0;l--){<br />&nbsp;&nbsp;&nbsp;&nbsp;if(ar1[l-1]=='\\'){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;check=ar1[l];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;}<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;if(check!='*')<br />&nbsp;&nbsp;&nbsp;&nbsp;strcat(ar1,"\\*.*");&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;if((Handle=_findfirst(ar1,&amp;FileInfo))==-1){<br />&nbsp;&nbsp;/*&nbsp; 以下为路径不包括通配符情况*/<br />&nbsp;&nbsp;&nbsp;printf("路径不存在！\n");<br />&nbsp;&nbsp;&nbsp;exit(0);<br />&nbsp;}<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;else{<br />&nbsp;&nbsp;do{<br />&nbsp;&nbsp;&nbsp;if (!(strcmp(FileInfo.name, "..")&amp;&amp;strcmp(FileInfo.name,"."))){<br />&nbsp;&nbsp;&nbsp;&nbsp;continue;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;char path_a[40];<br />/*&nbsp;以下旨在获取除去通配符后的文件路径&nbsp;*/ <br />&nbsp;&nbsp;int str_leng,t;<br />&nbsp;&nbsp;strcpy(path_a,ar1);<br />&nbsp;&nbsp;str_leng=strlen(path_a);<br />&nbsp;&nbsp;for(t= str_leng+1;;t--)<br />&nbsp;&nbsp;&nbsp;{if(path_a[t-1]=='\\'){<br />&nbsp;&nbsp;&nbsp;&nbsp;path_a[t]='\0';<br />&nbsp;&nbsp;&nbsp;&nbsp;break;}<br />&nbsp;&nbsp;&nbsp;else<br />&nbsp;&nbsp;&nbsp;&nbsp;path_a[t]='0';&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;char Tname[20];<br />&nbsp;&nbsp;strcpy(Tname,FileInfo.name);<br />&nbsp;&nbsp;&nbsp;strcat(path_a,Tname);&nbsp;&nbsp;//获取绝对路径 
<div>&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;Tadd(&amp;Thead,path_a);<br />&nbsp;&nbsp;&nbsp;add(&amp;head,FileInfo.name,FileInfo.size);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; count++;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;}while(_findnext(Handle,&amp;FileInfo)==0);&nbsp; <br />&nbsp;&nbsp;_findclose(Handle);
<div>&nbsp;&nbsp;<br />&nbsp;&nbsp;FILE *fp_stu,*fp_txt;<br />&nbsp;&nbsp;if((fp_stu=fopen(ar2,"ab+"))==NULL){<br />&nbsp;&nbsp;&nbsp;printf("Can't open++++ %s\n",ar2);<br />&nbsp;&nbsp;&nbsp;exit(1);<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;else{<br />&nbsp;&nbsp;&nbsp;rewind(fp_stu);<br />&nbsp;&nbsp;&nbsp;fwrite(&amp;count,sizeof(count),1,fp_stu);&nbsp;&nbsp;//记录文件总个数为int型，并放在打包文件头 
<div>&nbsp;&nbsp;&nbsp;Node *op;
<div>&nbsp;&nbsp;&nbsp;op=head-&gt;next;<br />&nbsp;&nbsp;&nbsp;while(op!=NULL){<br />&nbsp;&nbsp;&nbsp;&nbsp;fwrite(op,sizeof(*op),1,fp_stu);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;op=op-&gt;next;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;fclose(fp_stu);&nbsp;<br />&nbsp;&nbsp;}&nbsp;<br />&nbsp;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;Note *pt;<br />&nbsp;&nbsp;pt=Thead-&gt;next;<br />&nbsp;&nbsp;while(pt!=NULL){<br />&nbsp;&nbsp;&nbsp;file_in(pt-&gt;path,ar2);&nbsp;&nbsp;&nbsp;&nbsp; //文件读取及写入 <br />&nbsp;&nbsp;&nbsp;pt=pt-&gt;next;<br />&nbsp;&nbsp;}&nbsp;<br />&nbsp;}<br />}&nbsp;&nbsp; 
<div>&nbsp;<br />&nbsp;void unzip(char *Path_file,char *Path_out){<br />&nbsp;&nbsp;FILE *fp1,*fp2,*fp3;<br />&nbsp;&nbsp;char ch;<br />&nbsp;&nbsp;int num,m=0;<br />&nbsp;&nbsp;Node p;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;if((fp1=fopen(Path_file,"rb"))==NULL){<br />&nbsp;&nbsp;&nbsp;printf("Can't open %s\n",Path_file);<br />&nbsp;&nbsp;&nbsp;&nbsp;exit(1);<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;else if((fp2=fopen(Path_file,"rb"))==NULL){<br />&nbsp;&nbsp;&nbsp;printf("Can't open %s\n",Path_file);<br />&nbsp;&nbsp;&nbsp;&nbsp;exit(1);<br />&nbsp;&nbsp;&nbsp;}&nbsp;<br />&nbsp;&nbsp;else{<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;fseek(fp1,0L,SEEK_SET);&nbsp;<br />&nbsp;&nbsp;fseek(fp2,0L,SEEK_SET);&nbsp;&nbsp;<br />&nbsp;&nbsp;rewind(fp1);<br />&nbsp;&nbsp;rewind(fp1);<br />&nbsp;&nbsp;fread(&amp;num,sizeof(num),1,fp1);<br />&nbsp;&nbsp;printf("The file-count is&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; %d\n",num);<br />&nbsp;&nbsp;fseek(fp2,sizeof(int),SEEK_SET);<br />&nbsp;&nbsp;fseek(fp2,sizeof(p)*num,SEEK_CUR);<br />&nbsp;&nbsp;do {&nbsp;m++;<br />&nbsp;&nbsp;fread(&amp;p,sizeof(p),1,fp1);<br />&nbsp;&nbsp;char fullpath_out[40];<br />&nbsp;&nbsp;char name[20];<br />&nbsp;&nbsp;int i=0;<br />&nbsp;&nbsp;strcpy(name,p.name);<br />&nbsp;&nbsp;strcpy(fullpath_out,Path_out);<br />&nbsp;&nbsp;strcat(fullpath_out,name);<br />&nbsp;&nbsp;if((fp3=fopen(fullpath_out,"ab+"))==NULL){<br />&nbsp;&nbsp;&nbsp;printf("Can't open&nbsp;&nbsp;&nbsp; %s&nbsp;&nbsp; \n",fullpath_out);<br />&nbsp;&nbsp;&nbsp;&nbsp;exit(1);<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;else{<br />&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;for(i=0;i&lt;p.size;i+=(sizeof(char))){<br />&nbsp;&nbsp;&nbsp;fread(&amp;ch,sizeof(ch),1,fp2);<br />&nbsp;&nbsp;&nbsp;fwrite(&amp;ch,sizeof(ch),1,fp3);<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp; }<br />&nbsp;&nbsp;}while(m&lt;num);<br />&nbsp;&nbsp;&nbsp;fclose(fp1);<br />&nbsp;&nbsp;&nbsp;fclose(fp2);<br />&nbsp;&nbsp;&nbsp;fclose(fp3);<br />&nbsp;<br />&nbsp;}<br />&nbsp;&nbsp; <br />}<br />&nbsp;&nbsp; <br />&nbsp;void file_in(char *Path_r,char *Path_w){<br />&nbsp;&nbsp;FILE *fpr,*fpw;<br />&nbsp;&nbsp;char ch;<br />&nbsp;&nbsp;if((fpr=fopen(Path_r,"rb"))==NULL){<br />&nbsp;&nbsp;&nbsp;printf("Can't open&nbsp; 文件路径&nbsp; %s\n",Path_r);<br />&nbsp;&nbsp;&nbsp;&nbsp;exit(1);<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;if((fpw=fopen(Path_w,"ab+"))==NULL){<br />&nbsp;&nbsp;&nbsp;printf("Can't open&nbsp; 打包指向路径 %s\n",Path_w);<br />&nbsp;&nbsp;&nbsp;exit(1);<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;fseek(fpw,0L,SEEK_END);&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;while ((ch=fgetc(fpr))!=EOF)<br />&nbsp;&nbsp;&nbsp;&nbsp;fputc(ch,fpw);<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;fclose(fpr);<br />&nbsp;&nbsp;&nbsp;fclose(fpw);&nbsp;&nbsp;<br />&nbsp;}<br />&nbsp;<br />&nbsp;Lnote Tcreat(void){<br />&nbsp;&nbsp;Lnote Thead=(Lnote)malloc(sizeof(Note));<br />&nbsp;&nbsp;Thead-&gt;next=NULL;<br />&nbsp;&nbsp;return Thead;<br />&nbsp;}<br />&nbsp;void Tadd(Lnote *Thead,char *Path){<br />&nbsp;&nbsp;Note *s,*r;<br />&nbsp;&nbsp;r=*Thead;<br />&nbsp;&nbsp;while(r-&gt;next!=NULL){<br />&nbsp;&nbsp;&nbsp;r=r-&gt;next;&nbsp;&nbsp;<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;s=(Lnote)malloc(sizeof(Note));<br />&nbsp;&nbsp;strcpy(s-&gt;path,Path);<br />&nbsp;&nbsp;r-&gt;next=s;<br />&nbsp;&nbsp;s-&gt;next=NULL;<br />&nbsp;}<br />&nbsp;<br />&nbsp;List creat(void){<br />&nbsp;&nbsp;List head=(List)malloc(sizeof(Node));<br />&nbsp;&nbsp;head-&gt;next=NULL;<br />&nbsp;&nbsp;return head;<br />}<br />&nbsp;void add(List *head,char *Tname,int Tsize){<br />&nbsp;&nbsp;int i=0;<br />&nbsp;&nbsp;Node *s,*r;<br />&nbsp;&nbsp;r=*head;<br />&nbsp; <br />&nbsp;&nbsp;while(r-&gt;next!=NULL){<br />&nbsp;&nbsp;&nbsp;r=r-&gt;next;&nbsp;&nbsp;<br />&nbsp;&nbsp;}&nbsp;<br />&nbsp;&nbsp;s=(List)malloc(sizeof(Node));<br />&nbsp;&nbsp;strcpy(s-&gt;name,Tname);<br />&nbsp;&nbsp;s-&gt;size=Tsize;<br />&nbsp;&nbsp;r-&gt;next=s;<br />&nbsp;&nbsp;s-&gt;next=NULL;<br />&nbsp;} 
<div>&nbsp;
<div>&nbsp;
<div>&nbsp;
<div>int main(int argc,char *argv[]){<br />&nbsp;<br />&nbsp;&nbsp;<br />&nbsp;if(argc&gt;=1){<br />&nbsp;&nbsp;if(strcmp(argv[1],"help")==0){<br />&nbsp;&nbsp;&nbsp; &nbsp;printf("此程序命令行参数如下：&nbsp; \n");<br />&nbsp;&nbsp;&nbsp;&nbsp; printf("命令总数为 %d&nbsp;&nbsp;&nbsp; \n",argc+1);&nbsp; <br />&nbsp;&nbsp;for(int i=0;i&lt;argc;i++)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;printf("%s&nbsp;&nbsp;&nbsp;&nbsp; %d\n",argv[i],i);<br />&nbsp;&nbsp;&nbsp; &nbsp;}<br />&nbsp;}
<div>&nbsp;/*&nbsp; 以下对应于argv[1]为&lsquo;-l&rsquo;时，表示显示压缩包内的文件 */&nbsp;<br />&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; char a[20],b[5];<br />&nbsp;for(int i=0;i&lt;2;i++){<br />&nbsp;&nbsp;b[i]=argv[1][i];<br />&nbsp;} <br />&nbsp;&nbsp;b[2]='\0';<br />&nbsp; <br />&nbsp;&nbsp;&nbsp; if(strcmp(argv[1],"-l")==0){<br />&nbsp;&nbsp; &nbsp;&nbsp;lookthepack(argv[2]); &nbsp;<br />&nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;}&nbsp;<br />&nbsp;<br />&nbsp;/*&nbsp; 以下对应于argv[1]为&lsquo;-u&rsquo;时，表示解压 */&nbsp;<br />&nbsp;&nbsp; &nbsp;else if(strcmp(b,"-u")==0){<br />&nbsp;&nbsp; &nbsp;&nbsp;printf("sasda\n"); <br />&nbsp;&nbsp; &nbsp;&nbsp;unzip(argv[2],argv[3]);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;<br />&nbsp;else {&nbsp;<br />&nbsp;&nbsp;&nbsp;zip(argv[1],argv[2]);&nbsp;&nbsp;&nbsp;<br />&nbsp;}<br />&nbsp;&nbsp;return 0;<br />&nbsp; /*事例命令如下*/<br />//E:\打包事例\test.exe E:\打包事例\Thepack\*.*&nbsp;E:\打包事例\<br />//E:\打包事例\test.exe -l E:\打包事例\testqq.txt<br />//E:\打包事例\test.exe -u E:\打包事例\testqq.txt E:\打包事例\zxcv\
<div><br />&nbsp;<br />}
<div>&nbsp;
<div>&nbsp;
<div>还没有做递归和文件夹，也就是说仅仅对文件夹内文件适用。这个程序还差一点压缩，，之后有空再补上。

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>