<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修平衡树学习笔记' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>平衡树学习笔记</center></div><div class='banquan'>原文出处:本文由博客园博主OIer|zythonc提供。<br/>
原文连接:https://www.cnblogs.com/zythonc/p/11952589.html</div><br>
    <h1>&gt; 平 衡 树 学 习 笔 记 &lt;</h1>
<hr />
<p>&nbsp;</p>
<h2>目录</h2>
<p>　　<strong>) 1 -- &gt;</strong> <span style="text-decoration: underline;"><strong><span style="font-size: 15px;">平衡树简介</span></strong></span></p>
<p>　　<strong>) 2 -- &gt;</strong> <span style="text-decoration: underline; font-size: 15px;"><strong>平衡树实现</strong></span></p>
<p><span style="font-size: 15px;"><strong>　　　　| 1 = = &gt; &gt; </strong></span><span style="text-decoration: underline;"><span style="font-size: 15px;"><strong>平衡树存储</strong></span></span></p>
<hr />
<h4>&nbsp;</h4>
<h3>平衡树存储：</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">struct</span><span style="color: #000000;"> node{
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">int</span><span style="color: #000000;"> size,value,num,rand;
</span><span style="color: #008080;">3</span>     <span style="color: #0000ff;">int</span> son[<span style="color: #800080;">2</span><span style="color: #000000;">];
</span><span style="color: #008080;">4</span> }n[<span style="color: #800080;">1000001</span>]；</pre>
</div>
<p>&nbsp;</p>
<p>size就是节点的个数。</p>
<p>value是节点代表的权值。</p>
<p>权值相同的两个节点被视为一个，num记录折叠数量。</p>
<p>rand是随机数，用来维护平衡树。</p>
<p>son就是两个儿子。</p>
<hr />
<p>&nbsp;</p>
<h3>平衡树size更新：</h3>
<p>实际操作中，各个变量的值都是不断更新的，size也不例外。</p>
<p>函数体：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> inline <span style="color: #0000ff;">void</span> pushup(<span style="color: #0000ff;">int</span> root){}</pre>
</div>
<p>一个节点包括的节点个数用脚也能想到：左儿子size与右儿子size的和，加上这个节点折叠数量。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> n[root].size = n[n[root].son[<span style="color: #800080;">0</span>]].size + n[n[root].son[<span style="color: #800080;">1</span>]].size + n[root].num;</pre>
</div>
<p>完整的平衡树size更新代码：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> inline <span style="color: #0000ff;">void</span> pushup(<span style="color: #0000ff;">int</span><span style="color: #000000;"> root)
</span><span style="color: #008080;">2</span> <span style="color: #000000;">{
</span><span style="color: #008080;">3</span> 　　n[root].size = n[n[root].son[<span style="color: #800080;">0</span>]].size + n[n[root].son[<span style="color: #800080;">1</span>]].size +<span style="color: #000000;"> n[root].num;
</span><span style="color: #008080;">4</span> }</pre>
</div>
<hr />
<h4>&nbsp;</h4>
<h3>平衡树插入：</h3>
<p>学习完上面的内容，接下来的基本<span style="text-decoration: line-through;">逼死人的</span>操作插入与删除就很简单了：</p>
<p>由于Treap = Tree + Heap</p>
<p>所以平衡树插入与二叉排序树插入差不多</p>
<p>函数体：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> inline <span style="color: #0000ff;">void</span> add(<span style="color: #0000ff;">int</span> &amp;root,<span style="color: #0000ff;">int</span> data){}</pre>
</div>
<p>插入节点总会遇到<span style="text-decoration: line-through;">各种增加码量的</span>情况，需要我们一一判断：</p>
<p><span style="text-decoration: underline;"><strong>[ 1</strong><strong> ]</strong><strong>节点不存在</strong></span></p>
<p><span style="text-decoration: line-through;">什么？？节点不存在？？杀了出题人！</span></p>
<p>当插入函数用在建树中，这种情况很常见。</p>
<p>没有节点，那我们就开垦一个节点。<span style="text-decoration: line-through;">（水土流失，土地荒漠化请走开）</span></p>
<p>├ 节点总数加1</p>
<p>├ 新节点size为1</p>
<p>├ 新节点num为1</p>
<p>├ 权值为data</p>
<p>└ 生成rand</p>
<p>&rarr;&rarr;&rarr;崭新的节点！！<span style="text-decoration: line-through;">（不要998，不要98，只要9.8！）</span></p>
<p>代码实现就是一个简单的模拟：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">奇怪的行号</span> <span style="color: #0000ff;">if</span>(!<span style="color: #000000;">root)
</span><span style="color: #008080;">       9</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 　　　 8</span>     sum+=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 　　　 7     </span>root=<span style="color: #000000;">sum;
</span><span style="color: #008080;"> 　　　 6</span>     n[root].size=<span style="color: #800080;">1</span><span style="color: #000000;">;
　　　 </span><span style="color: #008080;"> 5</span>     n[root].num=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 　　　 4</span>     n[root].value=<span style="color: #000000;">data;
</span><span style="color: #008080;"> 　　　 3</span>     n[root].rand=<span style="color: #000000;">rand();
</span><span style="color: #008080;"> 　　　 2</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;">;
　　　 </span><span style="color: #008080;"> 1</span> }<br />　　　  0 <span style="text-decoration: line-through;">点火，起飞！！</span></pre>
</div>
<p><span style="text-decoration: underline;"><strong>&nbsp;[ 2 ]有一个权值为data的节点</strong></span></p>
<p>那更简单了！！</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">if</span> (n[root].value==<span style="color: #000000;">data)
</span><span style="color: #008080;">2</span> <span style="color: #000000;">{
</span><span style="color: #008080;">3</span>     n[root].num+=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;">4</span>     n[root].size+=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;">5</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">6</span> }</pre>
</div>
<p><span style="text-decoration: underline;">&nbsp;<strong>[ 3</strong><strong> ]</strong><strong>寻找子树满足情况一或情况二</strong></span></p>
<p>去哪棵子树呢？？定义一个变量。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">int</span> d(data&gt;n[root].value);</pre>
</div>
<p>有了明确的方向，就应该坚持走下去：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> add(n[root].son[d],data);</pre>
</div>
<p>随机数判断，随机旋转：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">if</span>(n[root].rand&lt;<span style="color: #000000;">n[n[root].son[d]].rand)
</span><span style="color: #008080;">2</span>     rotate(root,d^<span style="color: #800080;">1</span>);</pre>
</div>
<p>更新size：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> pushup(root);</pre>
</div>
<p>至此，插入操作基本完成。</p>
<p>完整平衡树插入代码：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> inline <span style="color: #0000ff;">void</span> add(<span style="color: #0000ff;">int</span> &amp;root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> data)
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">root)
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 5</span>         sum+=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 6</span>         root=<span style="color: #000000;">sum;
</span><span style="color: #008080;"> 7</span>         n[root].size=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 8</span>         n[root].num=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 9</span>         n[root].value=<span style="color: #000000;">data;
</span><span style="color: #008080;">10</span>         n[root].rand=<span style="color: #000000;">rand();
</span><span style="color: #008080;">11</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">12</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">if</span> (n[root].value==<span style="color: #000000;">data)
</span><span style="color: #008080;">14</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">15</span>         n[root].num+=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;">16</span>         n[root].size+=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">18</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">19</span>     <span style="color: #0000ff;">int</span> d(data&gt;<span style="color: #000000;">n[root].value);
</span><span style="color: #008080;">20</span> <span style="color: #000000;">    add(n[root].son[d],data);
</span><span style="color: #008080;">21</span>     <span style="color: #0000ff;">if</span>(n[root].rand&lt;<span style="color: #000000;">n[n[root].son[d]].rand)
</span><span style="color: #008080;">22</span>         rotate(root,d^<span style="color: #800080;">1</span><span style="color: #000000;">);
</span><span style="color: #008080;">23</span> <span style="color: #000000;">    pushup(root);
</span><span style="color: #008080;">24</span> }</pre>
</div>
<hr />
<h3>平衡树旋转：</h3>
<p>平衡树旋转不破坏平衡树的性质，也就是说</p>
<p>旋转前：A&lt;B&lt;C&lt;D&lt;E&lt;F</p>
<p>旋转后：A&lt;B&lt;C&lt;D&lt;E&lt;F</p>
<p>完整平衡树旋转代码：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> inline <span style="color: #0000ff;">void</span> rotate(<span style="color: #0000ff;">int</span> &amp;root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> way)
</span><span style="color: #008080;">2</span> <span style="color: #000000;">{
</span><span style="color: #008080;">3</span>     <span style="color: #0000ff;">int</span> copy=n[root].son[way^<span style="color: #800080;">1</span><span style="color: #000000;">];
</span><span style="color: #008080;">4</span>     n[root].son[way^<span style="color: #800080;">1</span>]=<span style="color: #000000;">n[copy].son[way];
</span><span style="color: #008080;">5</span>     n[copy].son[way]=<span style="color: #000000;">root;
</span><span style="color: #008080;">6</span> <span style="color: #000000;">    pushup(root);pushup(copy);
</span><span style="color: #008080;">7</span>     root=<span style="color: #000000;">copy;
</span><span style="color: #008080;">8</span> }</pre>
</div>
<hr />
<h3>&nbsp;平衡树删除：</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> inline <span style="color: #0000ff;">void</span> remove(<span style="color: #0000ff;">int</span> &amp;root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> data)
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">if</span>(!root) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">if</span>(data&lt;n[root].value) remove(n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">],data);
</span><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(data&gt;n[root].value) remove(n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">],data);
</span><span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">else</span>
<span style="color: #008080;"> 7</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">if</span>((!n[root].son[<span style="color: #800080;">0</span>])&amp;&amp;(!n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">]))
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">10</span>             n[root].num-=<span style="color: #800080;">1</span>,n[root].size-=<span style="color: #800080;">1</span><span style="color: #000000;">; 
</span><span style="color: #008080;">11</span>             <span style="color: #0000ff;">if</span>(n[root].num==<span style="color: #800080;">0</span>) root=<span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;">12</span> <span style="color: #000000;">        } 
</span><span style="color: #008080;">13</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(n[root].son[<span style="color: #800080;">0</span>]&amp;&amp;!n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">])
</span><span style="color: #008080;">14</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">15</span>             rotate(root,<span style="color: #800080;">1</span>);remove(n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">],data);
</span><span style="color: #008080;">16</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(!n[root].son[<span style="color: #800080;">0</span>]&amp;&amp;n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">])
</span><span style="color: #008080;">18</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">19</span>             rotate(root,<span style="color: #800080;">0</span>);remove(n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">],data);
</span><span style="color: #008080;">20</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">21</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(n[root].son[<span style="color: #800080;">0</span>]&amp;&amp;n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">])
</span><span style="color: #008080;">22</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">23</span>             <span style="color: #0000ff;">int</span> d=(n[n[root].son[<span style="color: #800080;">0</span>]].rand&gt;n[n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">]].rand);
</span><span style="color: #008080;">24</span> <span style="color: #000000;">            rotate(root,d);remove(n[root].son[d],data);
</span><span style="color: #008080;">25</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">26</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">27</span> <span style="color: #000000;">    pushup(root);
</span><span style="color: #008080;">28</span> }</pre>
</div>
<p>&nbsp;</p>
<hr />
<p>&nbsp;</p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> inline <span style="color: #0000ff;">int</span> rank(<span style="color: #0000ff;">int</span> root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> data)
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">if</span>(!<span style="color: #000000;">root)
</span><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">if</span>(n[root].value==<span style="color: #000000;">data)
</span><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">return</span> n[n[root].son[<span style="color: #800080;">0</span>]].size+<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">if</span>(n[root].value&lt;<span style="color: #000000;">data)
</span><span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">return</span> n[n[root].son[<span style="color: #800080;">0</span>]].size+n[root].num+rank(n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">],data);
</span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">if</span>(n[root].value&gt;<span style="color: #000000;">data)
</span><span style="color: #008080;">10</span>         <span style="color: #0000ff;">return</span> rank(n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">],data);
</span><span style="color: #008080;">11</span> }</pre>
</div>
<p>&nbsp;</p>
<hr />
<p>&nbsp;</p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> inline <span style="color: #0000ff;">int</span> find(<span style="color: #0000ff;">int</span> root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> data)
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">if</span>(!<span style="color: #000000;">root)
</span><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">if</span>(n[n[root].son[<span style="color: #800080;">0</span>]].size&gt;=<span style="color: #000000;">data)
</span><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">return</span> find(n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">],data);
</span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(n[n[root].son[<span style="color: #800080;">0</span>]].size+n[root].num&lt;<span style="color: #000000;">data)
</span><span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">return</span> find(n[root].son[<span style="color: #800080;">1</span>],data-n[root].num-n[n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">]].size);
</span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">else</span>
<span style="color: #008080;">10</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> n[root].value;
</span><span style="color: #008080;">11</span> }</pre>
</div>
<p>&nbsp;</p>
<hr />
<p>&nbsp;</p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre>inline <span style="color: #0000ff;">int</span> maxmin(<span style="color: #0000ff;">int</span> __a,<span style="color: #0000ff;">int</span> __b,<span style="color: #0000ff;">int</span><span style="color: #000000;"> __bool)
{
    </span><span style="color: #0000ff;">if</span>(__bool) <span style="color: #0000ff;">return</span><span style="color: #000000;"> max(__a,__b);
    </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">return</span><span style="color: #000000;"> min(__a,__b);
}
inline </span><span style="color: #0000ff;">int</span> pan(<span style="color: #0000ff;">int</span> __a,<span style="color: #0000ff;">int</span> __b,<span style="color: #0000ff;">int</span><span style="color: #000000;"> __bool)
{
    </span><span style="color: #0000ff;">if</span>(__bool) <span style="color: #0000ff;">return</span> (__a&gt;=__b?<span style="color: #800080;">1</span>:<span style="color: #800080;">0</span><span style="color: #000000;">);
    </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">return</span> (__a&lt;=__b?<span style="color: #800080;">1</span>:<span style="color: #800080;">0</span><span style="color: #000000;">);
}
inline </span><span style="color: #0000ff;">int</span> findin(<span style="color: #0000ff;">int</span> root,<span style="color: #0000ff;">int</span> data,<span style="color: #0000ff;">int</span><span style="color: #000000;"> way)
{
    </span><span style="color: #0000ff;">if</span>(!root) <span style="color: #0000ff;">return</span> inf+<span style="color: #000000;">way;
    </span><span style="color: #0000ff;">if</span>(pan(n[root].value,data,way)) <span style="color: #0000ff;">return</span> findin(n[root].son[way^<span style="color: #800080;">1</span><span style="color: #000000;">],data,way);
    </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">return</span><span style="color: #000000;"> maxmin(n[root].value,findin(n[root].son[way],data,way),way);
}</span></pre>
</div>
<p>&nbsp;</p>
<hr />
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>看道板子题：P3369</p>
<p>完整代码：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">  1</span> #include&lt;bits/stdc++.h&gt;
<span style="color: #008080;">  2</span> <span style="color: #0000ff;">#define</span> inf 2147483647
<span style="color: #008080;">  3</span> <span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;
</span><span style="color: #008080;">  4</span> <span style="color: #0000ff;">int</span> sum=<span style="color: #800080;">0</span>,tree_root=<span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;">  5</span> <span style="color: #0000ff;">struct</span><span style="color: #000000;"> node{
</span><span style="color: #008080;">  6</span>     <span style="color: #0000ff;">int</span><span style="color: #000000;"> size,value,num,rand;
</span><span style="color: #008080;">  7</span>     <span style="color: #0000ff;">int</span> son[<span style="color: #800080;">2</span><span style="color: #000000;">];
</span><span style="color: #008080;">  8</span> }n[<span style="color: #800080;">1000001</span><span style="color: #000000;">];
</span><span style="color: #008080;">  9</span> inline <span style="color: #0000ff;">int</span> maxmin(<span style="color: #0000ff;">int</span> __a,<span style="color: #0000ff;">int</span> __b,<span style="color: #0000ff;">int</span><span style="color: #000000;"> __bool)
</span><span style="color: #008080;"> 10</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 11</span>     <span style="color: #0000ff;">if</span>(__bool) <span style="color: #0000ff;">return</span><span style="color: #000000;"> max(__a,__b);
</span><span style="color: #008080;"> 12</span>     <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">return</span><span style="color: #000000;"> min(__a,__b);
</span><span style="color: #008080;"> 13</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 14</span> inline <span style="color: #0000ff;">void</span> pushup(<span style="color: #0000ff;">int</span> root){n[root].size=n[n[root].son[<span style="color: #800080;">0</span>]].size+n[n[root].son[<span style="color: #800080;">1</span>]].size+<span style="color: #000000;">n[root].num;}
</span><span style="color: #008080;"> 15</span> inline <span style="color: #0000ff;">void</span> rotate(<span style="color: #0000ff;">int</span> &amp;root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> way)
</span><span style="color: #008080;"> 16</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 17</span>     <span style="color: #0000ff;">int</span> copy=n[root].son[way^<span style="color: #800080;">1</span><span style="color: #000000;">];
</span><span style="color: #008080;"> 18</span>     n[root].son[way^<span style="color: #800080;">1</span>]=<span style="color: #000000;">n[copy].son[way];
</span><span style="color: #008080;"> 19</span>     n[copy].son[way]=<span style="color: #000000;">root;
</span><span style="color: #008080;"> 20</span> <span style="color: #000000;">    pushup(root);pushup(copy);
</span><span style="color: #008080;"> 21</span>     root=<span style="color: #000000;">copy;
</span><span style="color: #008080;"> 22</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 23</span> inline <span style="color: #0000ff;">void</span> add(<span style="color: #0000ff;">int</span> &amp;root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> data)
</span><span style="color: #008080;"> 24</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 25</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">root)
</span><span style="color: #008080;"> 26</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 27</span>         sum+=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 28</span>         root=<span style="color: #000000;">sum;
</span><span style="color: #008080;"> 29</span>         n[root].size=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 30</span>         n[root].num=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 31</span>         n[root].value=<span style="color: #000000;">data;
</span><span style="color: #008080;"> 32</span>         n[root].rand=<span style="color: #000000;">rand();
</span><span style="color: #008080;"> 33</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 34</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 35</span>     <span style="color: #0000ff;">if</span> (n[root].value==<span style="color: #000000;">data)
</span><span style="color: #008080;"> 36</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 37</span>         n[root].num+=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 38</span>         n[root].size+=<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 39</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 40</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 41</span>     <span style="color: #0000ff;">int</span> d(data&gt;<span style="color: #000000;">n[root].value);
</span><span style="color: #008080;"> 42</span> <span style="color: #000000;">    add(n[root].son[d],data);
</span><span style="color: #008080;"> 43</span>     <span style="color: #0000ff;">if</span>(n[root].rand&lt;<span style="color: #000000;">n[n[root].son[d]].rand)
</span><span style="color: #008080;"> 44</span>         rotate(root,d^<span style="color: #800080;">1</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 45</span> <span style="color: #000000;">    pushup(root);
</span><span style="color: #008080;"> 46</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 47</span> inline <span style="color: #0000ff;">void</span> remove(<span style="color: #0000ff;">int</span> &amp;root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> data)
</span><span style="color: #008080;"> 48</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 49</span>     <span style="color: #0000ff;">if</span>(!root) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 50</span>     <span style="color: #0000ff;">if</span>(data&lt;n[root].value) remove(n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">],data);
</span><span style="color: #008080;"> 51</span>     <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(data&gt;n[root].value) remove(n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">],data);
</span><span style="color: #008080;"> 52</span>     <span style="color: #0000ff;">else</span>
<span style="color: #008080;"> 53</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 54</span>         <span style="color: #0000ff;">if</span>((!n[root].son[<span style="color: #800080;">0</span>])&amp;&amp;(!n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">]))
</span><span style="color: #008080;"> 55</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 56</span>             n[root].num-=<span style="color: #800080;">1</span>,n[root].size-=<span style="color: #800080;">1</span><span style="color: #000000;">; 
</span><span style="color: #008080;"> 57</span>             <span style="color: #0000ff;">if</span>(n[root].num==<span style="color: #800080;">0</span>) root=<span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 58</span> <span style="color: #000000;">        } 
</span><span style="color: #008080;"> 59</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(n[root].son[<span style="color: #800080;">0</span>]&amp;&amp;!n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">])
</span><span style="color: #008080;"> 60</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 61</span>             rotate(root,<span style="color: #800080;">1</span>);remove(n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">],data);
</span><span style="color: #008080;"> 62</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 63</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(!n[root].son[<span style="color: #800080;">0</span>]&amp;&amp;n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">])
</span><span style="color: #008080;"> 64</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 65</span>             rotate(root,<span style="color: #800080;">0</span>);remove(n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">],data);
</span><span style="color: #008080;"> 66</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 67</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(n[root].son[<span style="color: #800080;">0</span>]&amp;&amp;n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">])
</span><span style="color: #008080;"> 68</span> <span style="color: #000000;">        {
</span><span style="color: #008080;"> 69</span>             <span style="color: #0000ff;">int</span> d=(n[n[root].son[<span style="color: #800080;">0</span>]].rand&gt;n[n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">]].rand);
</span><span style="color: #008080;"> 70</span> <span style="color: #000000;">            rotate(root,d);remove(n[root].son[d],data);
</span><span style="color: #008080;"> 71</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 72</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 73</span> <span style="color: #000000;">    pushup(root);
</span><span style="color: #008080;"> 74</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 75</span> inline <span style="color: #0000ff;">int</span> rank(<span style="color: #0000ff;">int</span> root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> data)
</span><span style="color: #008080;"> 76</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 77</span>     <span style="color: #0000ff;">if</span>(!<span style="color: #000000;">root)
</span><span style="color: #008080;"> 78</span>         <span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 79</span>     <span style="color: #0000ff;">if</span>(n[root].value==<span style="color: #000000;">data)
</span><span style="color: #008080;"> 80</span>         <span style="color: #0000ff;">return</span> n[n[root].son[<span style="color: #800080;">0</span>]].size+<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 81</span>     <span style="color: #0000ff;">if</span>(n[root].value&lt;<span style="color: #000000;">data)
</span><span style="color: #008080;"> 82</span>         <span style="color: #0000ff;">return</span> n[n[root].son[<span style="color: #800080;">0</span>]].size+n[root].num+rank(n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">],data);
</span><span style="color: #008080;"> 83</span>     <span style="color: #0000ff;">if</span>(n[root].value&gt;<span style="color: #000000;">data)
</span><span style="color: #008080;"> 84</span>         <span style="color: #0000ff;">return</span> rank(n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">],data);
</span><span style="color: #008080;"> 85</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 86</span> inline <span style="color: #0000ff;">int</span> find(<span style="color: #0000ff;">int</span> root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> data)
</span><span style="color: #008080;"> 87</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 88</span>     <span style="color: #0000ff;">if</span>(!<span style="color: #000000;">root)
</span><span style="color: #008080;"> 89</span>         <span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 90</span>     <span style="color: #0000ff;">if</span>(n[n[root].son[<span style="color: #800080;">0</span>]].size&gt;=<span style="color: #000000;">data)
</span><span style="color: #008080;"> 91</span>         <span style="color: #0000ff;">return</span> find(n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">],data);
</span><span style="color: #008080;"> 92</span>     <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(n[n[root].son[<span style="color: #800080;">0</span>]].size+n[root].num&lt;<span style="color: #000000;">data)
</span><span style="color: #008080;"> 93</span>         <span style="color: #0000ff;">return</span> find(n[root].son[<span style="color: #800080;">1</span>],data-n[root].num-n[n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">]].size);
</span><span style="color: #008080;"> 94</span>     <span style="color: #0000ff;">else</span>
<span style="color: #008080;"> 95</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> n[root].value;
</span><span style="color: #008080;"> 96</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 97</span> inline <span style="color: #0000ff;">int</span> pan(<span style="color: #0000ff;">int</span> __a,<span style="color: #0000ff;">int</span> __b,<span style="color: #0000ff;">int</span><span style="color: #000000;"> __bool)
</span><span style="color: #008080;"> 98</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 99</span>     <span style="color: #0000ff;">if</span>(__bool) <span style="color: #0000ff;">return</span> (__a&gt;=__b?<span style="color: #800080;">1</span>:<span style="color: #800080;">0</span><span style="color: #000000;">);
</span><span style="color: #008080;">100</span>     <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">return</span> (__a&lt;=__b?<span style="color: #800080;">1</span>:<span style="color: #800080;">0</span><span style="color: #000000;">);
</span><span style="color: #008080;">101</span> <span style="color: #000000;">}
</span><span style="color: #008080;">102</span> inline <span style="color: #0000ff;">int</span> findin(<span style="color: #0000ff;">int</span> root,<span style="color: #0000ff;">int</span> data,<span style="color: #0000ff;">int</span><span style="color: #000000;"> way)
</span><span style="color: #008080;">103</span> <span style="color: #000000;">{
</span><span style="color: #008080;">104</span>     <span style="color: #0000ff;">if</span>(!root) <span style="color: #0000ff;">return</span> inf+<span style="color: #000000;">way;
</span><span style="color: #008080;">105</span>     <span style="color: #0000ff;">if</span>(pan(n[root].value,data,way)) <span style="color: #0000ff;">return</span> findin(n[root].son[way^<span style="color: #800080;">1</span><span style="color: #000000;">],data,way);
</span><span style="color: #008080;">106</span>     <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">return</span><span style="color: #000000;"> maxmin(n[root].value,findin(n[root].son[way],data,way),way);
</span><span style="color: #008080;">107</span> <span style="color: #000000;">}
</span><span style="color: #008080;">108</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> main()
</span><span style="color: #008080;">109</span> <span style="color: #000000;">{
</span><span style="color: #008080;">110</span>     <span style="color: #0000ff;">int</span><span style="color: #000000;"> n,opt,x;
</span><span style="color: #008080;">111</span>     scanf(<span style="color: #800000;">"</span><span style="color: #800000;">%d</span><span style="color: #800000;">"</span>,&amp;<span style="color: #000000;">n);
</span><span style="color: #008080;">112</span>     <span style="color: #0000ff;">for</span>(register <span style="color: #0000ff;">int</span> i=<span style="color: #800080;">0</span>;i&lt;n;++<span style="color: #000000;">i)
</span><span style="color: #008080;">113</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">114</span>         scanf(<span style="color: #800000;">"</span><span style="color: #800000;">%d%d</span><span style="color: #800000;">"</span>,&amp;opt,&amp;<span style="color: #000000;">x);
</span><span style="color: #008080;">115</span>         <span style="color: #0000ff;">if</span>(opt==<span style="color: #800080;">1</span><span style="color: #000000;">) add(tree_root,x);
</span><span style="color: #008080;">116</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(opt==<span style="color: #800080;">2</span><span style="color: #000000;">) remove(tree_root,x);
</span><span style="color: #008080;">117</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(opt==<span style="color: #800080;">3</span>) printf(<span style="color: #800000;">"</span><span style="color: #800000;">%d\n</span><span style="color: #800000;">"</span><span style="color: #000000;">,rank(tree_root,x));
</span><span style="color: #008080;">118</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(opt==<span style="color: #800080;">4</span>) printf(<span style="color: #800000;">"</span><span style="color: #800000;">%d\n</span><span style="color: #800000;">"</span><span style="color: #000000;">,find(tree_root,x));
</span><span style="color: #008080;">119</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(opt==<span style="color: #800080;">5</span>) printf(<span style="color: #800000;">"</span><span style="color: #800000;">%d\n</span><span style="color: #800000;">"</span>,findin(tree_root,x,<span style="color: #800080;">1</span><span style="color: #000000;">));
</span><span style="color: #008080;">120</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(opt==<span style="color: #800080;">6</span>) printf(<span style="color: #800000;">"</span><span style="color: #800000;">%d\n</span><span style="color: #800000;">"</span>,findin(tree_root,x,<span style="color: #800080;">0</span><span style="color: #000000;">));
</span><span style="color: #008080;">121</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">122</span>     <span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;">123</span> }</pre>
</div>
<p>个人比较喜欢压行<span style="text-decoration: line-through;">（60行平衡树见过吗？？）</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('b9844ab8-f989-46bd-94be-a4ed24283d39')"><img id="code_img_closed_b9844ab8-f989-46bd-94be-a4ed24283d39" class="code_img_closed" src="./images/平衡树学习笔记0.png" alt="" /><img id="code_img_opened_b9844ab8-f989-46bd-94be-a4ed24283d39" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('b9844ab8-f989-46bd-94be-a4ed24283d39',event)" src="./images/平衡树学习笔记1.png" alt="" />
<div id="cnblogs_code_open_b9844ab8-f989-46bd-94be-a4ed24283d39" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> #include&lt;iostream&gt;
<span style="color: #008080;"> 2</span> #include&lt;cstdlib&gt;
<span style="color: #008080;"> 3</span> #include&lt;cstdio&gt;
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">#define</span> inf 2147483647
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">int</span> sum=<span style="color: #800080;">0</span>,tree_root=<span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">struct</span> node{<span style="color: #0000ff;">int</span> size,value,num,rand,son[<span style="color: #800080;">2</span>];}n[<span style="color: #800080;">500001</span><span style="color: #000000;">];
</span><span style="color: #008080;"> 8</span> inline <span style="color: #0000ff;">int</span> maxmin(<span style="color: #0000ff;">int</span> __a,<span style="color: #0000ff;">int</span> __b,<span style="color: #0000ff;">int</span> __bool){<span style="color: #0000ff;">if</span>(__bool) <span style="color: #0000ff;">return</span> max(__a,__b);<span style="color: #0000ff;">else</span> <span style="color: #0000ff;">return</span><span style="color: #000000;"> min(__a,__b);}
</span><span style="color: #008080;"> 9</span> inline <span style="color: #0000ff;">void</span> pushup(<span style="color: #0000ff;">int</span> root){n[root].size=n[n[root].son[<span style="color: #800080;">0</span>]].size+n[n[root].son[<span style="color: #800080;">1</span>]].size+<span style="color: #000000;">n[root].num;}
</span><span style="color: #008080;">10</span> inline <span style="color: #0000ff;">void</span> rotate(<span style="color: #0000ff;">int</span> &amp;root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> way){
</span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">int</span> copy=n[root].son[way^<span style="color: #800080;">1</span><span style="color: #000000;">];
</span><span style="color: #008080;">12</span>     n[root].son[way^<span style="color: #800080;">1</span>]=n[copy].son[way];n[copy].son[way]=<span style="color: #000000;">root;
</span><span style="color: #008080;">13</span>     pushup(root);pushup(copy);root=<span style="color: #000000;">copy;}
</span><span style="color: #008080;">14</span> inline <span style="color: #0000ff;">void</span> add(<span style="color: #0000ff;">int</span> &amp;root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> data){
</span><span style="color: #008080;">15</span>     <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">root){
</span><span style="color: #008080;">16</span>         sum+=<span style="color: #800080;">1</span>;root=<span style="color: #000000;">sum;
</span><span style="color: #008080;">17</span>         n[root].size=<span style="color: #800080;">1</span>;n[root].num=<span style="color: #800080;">1</span>;n[root].value=data;n[root].rand=<span style="color: #000000;">rand();
</span><span style="color: #008080;">18</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;">;}
</span><span style="color: #008080;">19</span>     <span style="color: #0000ff;">if</span>(n[root].value==data){n[root].num+=<span style="color: #800080;">1</span>,n[root].size+=<span style="color: #800080;">1</span>;<span style="color: #0000ff;">return</span><span style="color: #000000;">;}
</span><span style="color: #008080;">20</span>     <span style="color: #0000ff;">int</span> d(data&gt;<span style="color: #000000;">n[root].value);add(n[root].son[d],data);
</span><span style="color: #008080;">21</span>     <span style="color: #0000ff;">if</span>(n[root].rand&lt;n[n[root].son[d]].rand) rotate(root,d^<span style="color: #800080;">1</span><span style="color: #000000;">);
</span><span style="color: #008080;">22</span> <span style="color: #000000;">    pushup(root);}
</span><span style="color: #008080;">23</span> inline <span style="color: #0000ff;">void</span> remove(<span style="color: #0000ff;">int</span> &amp;root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> data){
</span><span style="color: #008080;">24</span>     <span style="color: #0000ff;">if</span>(!root) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">25</span>     <span style="color: #0000ff;">if</span>(data&lt;n[root].value) remove(n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">],data);
</span><span style="color: #008080;">26</span>     <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(data&gt;n[root].value) remove(n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">],data);
</span><span style="color: #008080;">27</span>     <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">28</span>         <span style="color: #0000ff;">if</span>((!n[root].son[<span style="color: #800080;">0</span>])&amp;&amp;(!n[root].son[<span style="color: #800080;">1</span>])){n[root].num-=<span style="color: #800080;">1</span>,n[root].size-=<span style="color: #800080;">1</span>; <span style="color: #0000ff;">if</span>(n[root].num==<span style="color: #800080;">0</span>) root=<span style="color: #800080;">0</span><span style="color: #000000;">;} 
</span><span style="color: #008080;">29</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(n[root].son[<span style="color: #800080;">0</span>]&amp;&amp;!n[root].son[<span style="color: #800080;">1</span>]){rotate(root,<span style="color: #800080;">1</span>);remove(n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">],data);}
</span><span style="color: #008080;">30</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(!n[root].son[<span style="color: #800080;">0</span>]&amp;&amp;n[root].son[<span style="color: #800080;">1</span>]){rotate(root,<span style="color: #800080;">0</span>);remove(n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">],data);}
</span><span style="color: #008080;">31</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(n[root].son[<span style="color: #800080;">0</span>]&amp;&amp;n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">]){
</span><span style="color: #008080;">32</span>             <span style="color: #0000ff;">int</span> d=(n[n[root].son[<span style="color: #800080;">0</span>]].rand&gt;n[n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">]].rand);
</span><span style="color: #008080;">33</span> <span style="color: #000000;">            rotate(root,d);remove(n[root].son[d],data);}}
</span><span style="color: #008080;">34</span> <span style="color: #000000;">    pushup(root);}
</span><span style="color: #008080;">35</span> inline <span style="color: #0000ff;">int</span> rank(<span style="color: #0000ff;">int</span> root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> data){
</span><span style="color: #008080;">36</span>     <span style="color: #0000ff;">if</span>(!root) <span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;">37</span>     <span style="color: #0000ff;">if</span>(n[root].value==data) <span style="color: #0000ff;">return</span> n[n[root].son[<span style="color: #800080;">0</span>]].size+<span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #008080;">38</span>     <span style="color: #0000ff;">if</span>(n[root].value&lt;data) <span style="color: #0000ff;">return</span> n[n[root].son[<span style="color: #800080;">0</span>]].size+n[root].num+rank(n[root].son[<span style="color: #800080;">1</span><span style="color: #000000;">],data);
</span><span style="color: #008080;">39</span>     <span style="color: #0000ff;">if</span>(n[root].value&gt;data) <span style="color: #0000ff;">return</span> rank(n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">],data);}
</span><span style="color: #008080;">40</span> inline <span style="color: #0000ff;">int</span> find(<span style="color: #0000ff;">int</span> root,<span style="color: #0000ff;">int</span><span style="color: #000000;"> data){
</span><span style="color: #008080;">41</span>     <span style="color: #0000ff;">if</span>(!root) <span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;">42</span>     <span style="color: #0000ff;">if</span>(n[n[root].son[<span style="color: #800080;">0</span>]].size&gt;=data) <span style="color: #0000ff;">return</span> find(n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">],data);
</span><span style="color: #008080;">43</span>     <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(n[n[root].son[<span style="color: #800080;">0</span>]].size+n[root].num&lt;data) <span style="color: #0000ff;">return</span> find(n[root].son[<span style="color: #800080;">1</span>],data-n[root].num-n[n[root].son[<span style="color: #800080;">0</span><span style="color: #000000;">]].size);
</span><span style="color: #008080;">44</span>     <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">return</span><span style="color: #000000;"> n[root].value;}
</span><span style="color: #008080;">45</span> inline <span style="color: #0000ff;">int</span> pan(<span style="color: #0000ff;">int</span> __a,<span style="color: #0000ff;">int</span> __b,<span style="color: #0000ff;">int</span> __bool){<span style="color: #0000ff;">if</span>(__bool) <span style="color: #0000ff;">return</span> (__a&gt;=__b?<span style="color: #800080;">1</span>:<span style="color: #800080;">0</span>);<span style="color: #0000ff;">else</span> <span style="color: #0000ff;">return</span> (__a&lt;=__b?<span style="color: #800080;">1</span>:<span style="color: #800080;">0</span><span style="color: #000000;">);}
</span><span style="color: #008080;">46</span> inline <span style="color: #0000ff;">int</span> findin(<span style="color: #0000ff;">int</span> root,<span style="color: #0000ff;">int</span> data,<span style="color: #0000ff;">int</span><span style="color: #000000;"> way){
</span><span style="color: #008080;">47</span>     <span style="color: #0000ff;">if</span>(!root) <span style="color: #0000ff;">return</span> inf+<span style="color: #000000;">way;
</span><span style="color: #008080;">48</span>     <span style="color: #0000ff;">if</span>(pan(n[root].value,data,way)) <span style="color: #0000ff;">return</span> findin(n[root].son[way^<span style="color: #800080;">1</span><span style="color: #000000;">],data,way);
</span><span style="color: #008080;">49</span>     <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">return</span><span style="color: #000000;"> maxmin(n[root].value,findin(n[root].son[way],data,way),way);}
</span><span style="color: #008080;">50</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> main(){
</span><span style="color: #008080;">51</span>     <span style="color: #0000ff;">int</span><span style="color: #000000;"> n,opt,x;
</span><span style="color: #008080;">52</span>     scanf(<span style="color: #800000;">"</span><span style="color: #800000;">%d</span><span style="color: #800000;">"</span>,&amp;<span style="color: #000000;">n);
</span><span style="color: #008080;">53</span>     <span style="color: #0000ff;">for</span>(register <span style="color: #0000ff;">int</span> i=<span style="color: #800080;">0</span>;i&lt;n;++<span style="color: #000000;">i){
</span><span style="color: #008080;">54</span>         scanf(<span style="color: #800000;">"</span><span style="color: #800000;">%d%d</span><span style="color: #800000;">"</span>,&amp;opt,&amp;<span style="color: #000000;">x);
</span><span style="color: #008080;">55</span>         <span style="color: #0000ff;">if</span>(opt==<span style="color: #800080;">1</span><span style="color: #000000;">) add(tree_root,x);
</span><span style="color: #008080;">56</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(opt==<span style="color: #800080;">2</span><span style="color: #000000;">) remove(tree_root,x);
</span><span style="color: #008080;">57</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(opt==<span style="color: #800080;">3</span>) printf(<span style="color: #800000;">"</span><span style="color: #800000;">%d\n</span><span style="color: #800000;">"</span><span style="color: #000000;">,rank(tree_root,x));
</span><span style="color: #008080;">58</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(opt==<span style="color: #800080;">4</span>) printf(<span style="color: #800000;">"</span><span style="color: #800000;">%d\n</span><span style="color: #800000;">"</span><span style="color: #000000;">,find(tree_root,x));
</span><span style="color: #008080;">59</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(opt==<span style="color: #800080;">5</span>) printf(<span style="color: #800000;">"</span><span style="color: #800000;">%d\n</span><span style="color: #800000;">"</span>,findin(tree_root,x,<span style="color: #800080;">1</span><span style="color: #000000;">));
</span><span style="color: #008080;">60</span>         <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(opt==<span style="color: #800080;">6</span>) printf(<span style="color: #800000;">"</span><span style="color: #800000;">%d\n</span><span style="color: #800000;">"</span>,findin(tree_root,x,<span style="color: #800080;">0</span>));}<span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span>;}</pre>
</div>
<span class="cnblogs_code_collapse">压行平衡树</span></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>