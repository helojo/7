<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修44.QT-安装MySQL、测试连接MySQL' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>44.QT-安装MySQL、测试连接MySQL</center></div><div class='banquan'>原文出处:本文由博客园博主NQian提供。<br/>
原文连接:https://www.cnblogs.com/lifexy/p/10938382.html</div><br>
    <p><span style="font-size: 14px;">在上章学习了<span style="text-decoration: underline;"><span style="color: #0000ff;"><a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/lifexy/p/10921958.html"><span style="color: #0000ff; text-decoration: underline;">42.QT-操作SQLite数据库</span></a></span></span>后,发现MySQL和SQLite的语句都大致相同,所以本章只测试MySQL是否能使用</span></p>
<p><span style="font-size: 15px;">MySQL安装参考链接:</span><a href="https://blog.csdn.net/qq_38455201/article/details/83419450" target="_blank"><span style="text-decoration: underline; color: #0000ff;">https://blog.csdn.net/qq_38455201/article/details/83419450</span></a></p>
<p><span style="font-size: 15px;"><strong>&nbsp;</strong></span></p>
<p><span style="font-size: 18px; color: #008000; background-color: #ffff99;"><strong>1.由于QT</strong><strong>版本是32</strong><strong>位,</strong><strong>所以MySQL</strong><strong>安装也得是32</strong><strong>位</strong></span></p>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL0.png" alt="" width="473" height="124" /></span></p>
<p>&nbsp;</p>
<p><span style="font-size: 18px; color: #008000; background-color: #ffff99;"><strong>2.MySQL</strong><strong>安装</strong></span></p>
<p><span style="font-size: 15px;">下载地址<a href="https://dev.mysql.com/downloads/mysql/5.7.html#downloads">https://dev.mysql.com/downloads/mysql/5.7.html#downloads</a>,选择32位的:</span></p>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL1.png" alt="" width="434" height="316" /></span></p>
<p><span style="font-size: 15px;">下载完成后解压到: <span style="color: #ff0000;">D:\MySQL5.7_win32</span></span></p>
<p><span style="font-size: 15px; color: #800000;"><strong>然后配置Path</strong><strong>环境变量</strong></span></p>
<p><span style="font-size: 15px;">新增变量名:</span></p>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL2.png" alt="" width="337" height="113" /></span></p>
<p><span style="font-size: 15px;">然后在Path变量里添加路径:</span></p>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL3.png" alt="" width="345" height="97" /></span></p>
<ul>
<li><span style="font-size: 15px;"><span style="color: #ff0000;"><strong>%MYSQL_HOME%</strong></span>：表示变量名,等价于<span style="color: #ff0000;">D:\MySQL5.7_win32\mysql-5.7.26-win32</span></span></li>
</ul>
<p><span style="font-size: 15px;">&nbsp;</span></p>
<p><span style="color: #800000;"><strong><span style="font-size: 15px;">配置文件</span></strong></span></p>
<p><span style="font-size: 15px;">首先在D:\MySQL5.7_win32\mysql-5.7.26-win32里创建<span style="color: #ff0000;">data文件夹</span>,用来mySQL存储数据.</span></p>
<p><span style="font-size: 15px;">然后在D:\MySQL5.7_win32\mysql-5.7.26-win32里创建<span style="color: #ff0000;">my.ini文件</span>(在linux下则为my.cnf):</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysql</span><span style="color: #ff0000;">]</span><span style="color: #000000;">
# 设置mysql客户端默认字符集
</span><span style="color: #0000ff;">default</span><span style="color: #808080;">-</span><span style="color: #0000ff;">character</span><span style="color: #808080;">-</span><span style="color: #0000ff;">set</span><span style="color: #808080;">=</span><span style="color: #000000;">utf8

# 数据库服务端配置项
</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysqld</span><span style="color: #ff0000;">]</span><span style="color: #000000;">

# 设置3306端口
port </span><span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">3306</span><span style="color: #000000;">

# 设置MYSQL的安装目录
basedir</span><span style="color: #808080;">=</span> D:\\MySQL5.7_win32\\mysql<span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">5.7</span>.<span style="color: #800000; font-weight: bold;">26</span><span style="color: #808080;">-</span><span style="color: #000000;">win32

# 设置MYSQL数据库的数据的存放目录
datadir</span><span style="color: #808080;">=</span>D:\\MySQL5.7_win32\\mysql<span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">5.7</span>.<span style="color: #800000; font-weight: bold;">26</span><span style="color: #808080;">-</span><span style="color: #000000;">win32\\data

# 允许最大连接数
max_connections</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">200</span><span style="color: #000000;">

# 服务端使用的字符集设置为utf8
</span><span style="color: #0000ff;">character</span><span style="color: #808080;">-</span><span style="color: #0000ff;">set</span><span style="color: #808080;">-</span>server<span style="color: #808080;">=</span><span style="color: #000000;">utf8

# 创建新表时将使用的默认存储引擎
# </span><span style="color: #0000ff;">default</span><span style="color: #808080;">-</span>storage<span style="color: #808080;">-</span>engine<span style="color: #808080;">=</span><span style="color: #000000;">INNODB

#设置模式
sql_mode</span><span style="color: #808080;">=</span><span style="color: #000000;">NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES

# skip</span><span style="color: #808080;">-</span><span style="color: #0000ff;">grant</span><span style="color: #808080;">-</span><span style="color: #000000;">tables跳过密码验证,一般忘记密码,才是用它,重新改密码
#skip</span><span style="color: #808080;">-</span><span style="color: #0000ff;">grant</span><span style="color: #808080;">-</span><span style="color: #000000;">tables

</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">WindowsMySQLServer</span><span style="color: #ff0000;">]</span><span style="color: #000000;">
Server</span><span style="color: #808080;">=</span> D:\\MySQL5.7_win32\\mysql<span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">5.7</span>.<span style="color: #800000; font-weight: bold;">26</span><span style="color: #808080;">-</span>win32\\bin\\mysqld.exe</pre>
</div>
<p><span style="color: #800000;"><strong><span style="font-size: 15px;">安装MySQL服务以及初始化</span></strong></span></p>
<p><span style="font-size: 15px;">打开CMD输入:</span></p>
<div class="cnblogs_code">
<pre>mysqld install             <span style="color: #008000;">//</span><span style="color: #008000;">安装SQL后台服务程序(mysqld),mysqld用来实现让客户端通过连接服务器来访问数据库</span><span style="color: #000000;">
mysqld </span>--initlialize      <span style="color: #008000;">//</span><span style="color: #008000;">初始化mysqld</span><span style="color: #000000;">
net start mysql           </span><span style="color: #008000;">//</span><span style="color: #008000;">启动MySQL</span></pre>
</div>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL4.png" alt="" /></span></p>
<p><span style="color: #800000;"><strong><span style="font-size: 15px;">更改密码</span></strong></span></p>
<p><span style="font-size: 15px;">首先找到初始密码,密码位于data文件夹*.err文件里:</span></p>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL5.png" alt="" width="487" height="292" /></span></p>
<p><span style="font-size: 15px;">打开,找到密码为N0aeT3lp.tzy:</span></p>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL6.png" alt="" width="491" height="36" /></span></p>
<p><span style="font-size: 15px;">继续在CMD中输入:</span></p>
<div class="cnblogs_code">
<pre>mysql -u root &ndash;p            <span style="color: #008000;">//</span><span style="color: #008000;">-u表示输入用户名,-p表示输入密码,按下回车后则会要求输入密码N0aeT3lp.tzy</span>
<span style="color: #000000;">
alter user root@localhost identified by </span>'123456';   <span style="color: #008000;">//</span><span style="color: #008000;">改为123456</span></pre>
</div>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL7.png" alt="" /></span></p>
<p><span style="font-size: 15px;">修改密码也可以输入:</span></p>
<div class="cnblogs_code">
<pre>set password <span style="color: #0000ff;">for</span> root@localhost = password('123');          <span style="color: #008000;">//</span><span style="color: #008000;">修改密码为123</span></pre>
</div>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL8.png" alt="" /></span></p>
<p>&nbsp;</p>
<p><span style="font-size: 15px; color: #800000;"><strong>使用navicat管理数据库工具</strong><strong>连接数据库</strong></span></p>
<p>使用<span style="color: #ff0000;">navicat工具</span>可以方便操作数据库,下载后,我们通过ip地址访问时,发现打印如下所示:</p>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL9.png" alt="" width="442" height="72" /></span></p>
<p><span style="font-size: 15px;">打开CMD配置</span></p>
<div class="cnblogs_code">
<pre>GRANT ALL PRIVILEGES ON *.* TO 'myuser'@'%' IDENTIFIED BY 'mypassword' WITH GRANT OPTION;      <span style="color: #008000;">//</span><span style="color: #008000;">修改,允许所有访问</span><span style="color: #000000;">
flush privileges;           </span><span style="color: #008000;">//</span><span style="color: #008000;">使修改立即生效</span></pre>
</div>
<p><span style="font-size: 15px;">如下图所示:</span></p>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL10.png" alt="" width="422" height="109" /></span></p>
<p><span style="font-size: 15px;">然后再次通过ip地址访问,发现OK:</span></p>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL11.png" alt="" width="262" height="244" /></span></p>
<p>&nbsp;</p>
<p><span style="font-size: 18px; color: #008000; background-color: #ffff99;"><strong>3.接下来开始使用QT</strong><strong>测试(</strong><strong>使用QT5.7</strong><strong>版本)</strong></span></p>
<p><span style="font-size: 15px;">连接MySQL发现打印:</span></p>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL12.png" alt="" /></span></p>
<p><span style="font-size: 15px;">因为缺少驱动文件libmysql.dll,该文件位于: D:\MySQL5.7_win32\mysql-5.7.26-win32\lib</span></p>
<p><span style="color: #ff0000;"><strong><span style="font-size: 15px;">方法1:</span></strong></span></p>
<p><span style="font-size: 15px;">将libmysql.dll复制到Qt5.7.1\5.7\mingw53_32\bin目录下</span></p>
<p><span style="color: #ff0000;"><strong><span style="font-size: 15px;">方法2:</span></strong></span></p>
<p><span style="font-size: 15px;">将libmysql.dll复制到debug或者release下</span></p>
<p><span style="font-size: 15px;">&nbsp;</span></p>
<p><span style="color: #800000;"><strong><span style="font-size: 15px;">开始测试</span></strong></span></p>
<p><span style="font-size: 15px;">1)首先创建一个students数据库:</span></p>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL13.png" alt="" /></span></p>
<p><span style="font-size: 15px;">2)写QT代码</span></p>
<div class="cnblogs_code">
<pre>QSqlDatabase  db =  QSqlDatabase::addDatabase(<span style="color: #800000;">"</span><span style="color: #800000;">QMYSQL</span><span style="color: #800000;">"</span><span style="color: #000000;">);

db.setHostName(</span><span style="color: #800000;">"</span><span style="color: #800000;">192.168.0.100</span><span style="color: #800000;">"</span>);      <span style="color: #008000;">//如果填入</span><span style="color: #008000;">localhost,则表示链接本地的数据库</span><span style="color: #000000;">
db.setDatabaseName(</span><span style="color: #800000;">"</span><span style="color: #800000;">students</span><span style="color: #800000;">"</span>);       <span style="color: #008000;">//</span><span style="color: #008000;">要连接的数据库名</span><span style="color: #000000;">
db.setUserName(</span><span style="color: #800000;">"</span><span style="color: #800000;">root</span><span style="color: #800000;">"</span><span style="color: #000000;">);              
db.setPassword(</span><span style="color: #800000;">"</span><span style="color: #800000;">sql</span><span style="color: #800000;">"</span><span style="color: #000000;">);
db.setPort(</span><span style="color: #800080;">3306</span><span style="color: #000000;">);

</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(db.open())
{
    query.exec(</span><span style="color: #800000;">"</span><span style="color: #800000;">DROP TABLE students</span><span style="color: #800000;">"</span>);    <span style="color: #008000;">//</span><span style="color: #008000;">删除名为students的表</span>
<span style="color: #000000;"> 
    query.exec(</span><span style="color: #800000;">"</span><span style="color: #800000;">CREATE TABLE students(</span><span style="color: #800000;">"</span>
               <span style="color: #800000;">"</span><span style="color: #800000;">id INT NOT NULL AUTO_INCREMENT,</span><span style="color: #800000;">"</span>
               <span style="color: #800000;">"</span><span style="color: #800000;">name VARCHAR(20) NOT NULL,</span><span style="color: #800000;">"</span>
               <span style="color: #800000;">"</span><span style="color: #800000;">sroce INT NOT NULL,</span><span style="color: #800000;">"</span>
               <span style="color: #800000;">"</span><span style="color: #800000;">class VARCHAR(20) NOT NULL,</span><span style="color: #800000;">"</span>
               <span style="color: #800000;">"</span><span style="color: #800000;">PRIMARY KEY (id) )ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><span style="color: #800000;">"</span><span style="color: #000000;">);
              </span><span style="color: #008000;">//</span><span style="color: #008000;">重新创建一个students表,标题分别为id、name、score、class</span>
<span style="color: #000000;">
 
    query.exec(</span><span style="color: #800000;">"</span><span style="color: #800000;">INSERT INTO students(name,sroce,class) VALUES ('小a', 85, '初2-1班')</span><span style="color: #800000;">"</span><span style="color: #000000;">);
    query.exec(</span><span style="color: #800000;">"</span><span style="color: #800000;">INSERT INTO students(name,sroce,class) VALUES ('小b', 15, '初2-2班')</span><span style="color: #800000;">"</span><span style="color: #000000;">);
    query.exec(</span><span style="color: #800000;">"</span><span style="color: #800000;">INSERT INTO students(name,sroce,class) VALUES ('小c', 35, '初2-3班')</span><span style="color: #800000;">"</span><span style="color: #000000;">);  
}</span></pre>
</div>
<p><span style="font-size: 15px;">运行结束后,打印数据表是否有数据:</span></p>
<p><span style="font-size: 15px;">&nbsp;<img src="./images/44.QT-安装MySQL、测试连接MySQL14.png" alt="" /></span></p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>