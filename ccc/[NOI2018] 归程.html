<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='ç”µè„‘,ç”µè„‘è®²è§£,ç”µè„‘æŠ€æœ¯,ç¼–ç¨‹,ç”µè„‘æ•…éšœç»´ä¿®[NOI2018] å½’ç¨‹' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>é¦–é¡µ</a></li>
</div><div onclick='hidden1()' >åˆ†äº«</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>[NOI2018] å½’ç¨‹</center></div><div class='banquan'>åŸæ–‡å‡ºå¤„:æœ¬æ–‡ç”±åšå®¢å›­åšä¸»nostaæä¾›ã€‚<br/>
åŸæ–‡è¿æ¥:https://www.cnblogs.com/nosta/p/10912353.html</div><br>
    <p>å¥½ä¹…æ²¡æ›´æ–°åšå®¢äº†â€¦â€¦</p>
<p>è¯´è¯´æœ¬é¢˜ï¼Œé¢„å¤„ç†å‡ºæ‰€æœ‰çš„dis[x]è¡¨ç¤º1è‡³xçš„é•¿åº¦ï¼Œè¯¢é—®(v,p)çš„ç­”æ¡ˆä¸ºmin_{minLev(x,v)&gt;p} dis[x]ã€‚å»ºç«‹å…³äºlevä»å¤§åˆ°å°çš„kruskalé‡æ„æ ‘ï¼Œåˆ™minlev(x,v)=val[lca(x,v)]ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œä»»æ„åœ¨é‡æ„æ ‘vçš„æŸä¸ªç¥–å…ˆdæœ‰val[d]&gt;pï¼Œå¯ä»¥ç”¨då­æ ‘ï¼ˆé™¤å¼€åŒ…å«vèŠ‚ç‚¹çš„å„¿å­å­æ ‘ï¼‰ä¸­æ‰€æœ‰å¶èŠ‚ç‚¹çš„æœ€å°disæ¥æ›´æ–°ç­”æ¡ˆã€‚</p>
<p>æ³¨æ„åˆ°é‡æ„æ ‘æ˜¯ä¸ªäºŒå‰æ ‘ã€‚å› æ­¤å¯¹äºå…³äºdæŸ¥è¯¢çš„å­æ ‘ä»æ˜¯ä¸€ä¸ªå®Œæ•´çš„å­æ ‘ç»“æ„ï¼Œè®¾ä¸ºd'(dçš„æŸä¸ªå„¿å­)ã€‚å¦‚æœä»¤mindis[x]è¡¨ç¤ºå­æ ‘xçš„å¶èŠ‚ç‚¹çš„æœ€å°diså€¼ï¼Œåˆ™ç›´æ¥æ‹¿mindis[d']æ¥æ›´æ–°ã€‚</p>
<p>è‹¥på§‹ç»ˆä¸º-inf,å¯ä»¥è‡ªé¡¶å‘ä¸‹é¢„å¤„ç†ä¸Šè¿°å€¼ï¼Œè½¬æ¢åˆ°ä¸€èˆ¬æƒ…å†µå°±å¯ä»¥è€ƒè™‘æ ‘ä¸Šä¸»å¸­æ ‘äº†ã€‚<span class="math inline">\(%^#\)</span>&amp;^&amp;â€¦â€¦ è¿™ä¹ˆå†™å°±æˆç¬‘è¯äº†â€¦â€¦æ³¨æ„åˆ°æ»¡è¶³d[v]&gt;pçš„ç‚¹é›†ä¸­åˆ†å¸ƒåœ¨vçš„ç¥–å…ˆé“¾çš„å‰ç¼€ï¼Œå¯ä»¥å€å¢æ‰¾å‡ºé‚£ä¸ªåˆ†ç•Œç‚¹(æ·±åº¦æœ€å°çš„val&lt;=pçš„ç‚¹)ç„¶åå–å®ƒçš„mindisâ€¦â€¦</p>
<p><del>1Aäº†å¼€å¿ƒğŸ˜Š</del></p>
<p>å‚è€ƒå®ç°</p>
<pre><code>#include &lt;bits/stdc++.h&gt;
using namespace std;
const int N=8e5+10;

struct Enode {
    int u,v,a,l;
    bool operator&lt;(const Enode&amp;d) const{return a&gt;d.a;}
};
struct Pnode {
    int key,dis;
    bool operator&lt;(const Pnode&amp;d) const{return dis&gt;d.dis;}
};

int cnt,dis[N];
int head[N],to[N],len[N],lst[N];
bool vis[N];

void ins(int x,int y,int w) {
    to[++cnt]=y,len[cnt]=w,lst[cnt]=head[x],head[x]=cnt;
    to[++cnt]=x,len[cnt]=w,lst[cnt]=head[y],head[y]=cnt;
}
priority_queue&lt;Pnode&gt; pq;
void dijkstra() {
    memset(dis,0x3f,sizeof dis);
    pq.push((Pnode){1,dis[1]=0});
    while(pq.size()) {
        int x=pq.top().key; pq.pop();
        if(vis[x]) continue; vis[x]=1;
        for(int i=head[x]; i; i=lst[i]) if(dis[to[i]]&gt;dis[x]+len[i]) 
            pq.push((Pnode){to[i],dis[to[i]]=dis[x]+len[i]});
    }
}

Enode a[N];
int n,m,rt[N],val[N],ch[N][2];
int fa[N][20];

int find(int x) {return rt[x]==x?x:rt[x]=find(rt[x]);}
void dfs(int x,int d) {
    for(int i=1; (1&lt;&lt;i)&lt;=d; ++i) fa[x][i]=fa[fa[x][i-1]][i-1];
    if(x&gt;n) {
        fa[ch[x][0]][0]=x; dfs(ch[x][0],d+1);
        fa[ch[x][1]][0]=x; dfs(ch[x][1],d+1);
        dis[x]=min(dis[ch[x][0]],dis[ch[x][1]]);
    }
}

void rebuild() {
    int tot=n;
    sort(a+1,a+m+1); 
    for(int i=1; i&lt;=n; ++i) {
        memset(fa[i],0,sizeof fa[i]);
        rt[i]=i;
    }
    for(int i=1; i&lt;=m; ++i) {
        int x=find(a[i].u),y=find(a[i].v);
        if(x!=y) {
            tot++; 
            memset(fa[tot],0,sizeof fa[tot]);
            rt[tot]=tot; val[tot]=a[i].a;
            rt[ch[tot][0]=x]=rt[ch[tot][1]=y]=tot;
        }
    }
    dfs(tot,1);
}
int query(int x,int p) {
    for(int i=19; ~i; --i) if(fa[x][i]&amp;&amp;val[fa[x][i]]&gt;p) x=fa[x][i];
    return dis[x];
}


int main() {
    int T;
    scanf(&quot;%d&quot;,&amp;T);
    while(T--) {
        cnt=0;
        memset(vis,0,sizeof vis);
        memset(head,0,sizeof head);
        scanf(&quot;%d%d&quot;,&amp;n,&amp;m);
        for(int i=1; i&lt;=m; ++i) {
            scanf(&quot;%d%d%d%d&quot;,&amp;a[i].u,&amp;a[i].v,&amp;a[i].l,&amp;a[i].a);
            ins(a[i].u,a[i].v,a[i].l);
        }
        dijkstra();
        rebuild();
        int Q,K,S,lans=0;
        scanf(&quot;%d%d%d&quot;,&amp;Q,&amp;K,&amp;S);
        for(int v,p; Q--; ) {
            scanf(&quot;%d%d&quot;,&amp;v,&amp;p);
            v=(v+K*lans-1)%n+1;
            p=(p+K*lans)%(S+1);
            lans=query(v,p);
            printf(&quot;%d\n&quot;,lans);
        }
    }
    return 0;
}</code></pre>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>