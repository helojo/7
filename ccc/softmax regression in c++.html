<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修softmax regression in c++' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>softmax regression in c++</center></div><div class='banquan'>原文出处:本文由博客园博主东宫得臣提供。<br/>
原文连接:https://www.cnblogs.com/donggongdechen/p/11062367.html</div><br>
    <div class="cnblogs_code">
<div>#include &lt;iostream&gt;<br />#include &lt;vector&gt;<br />#include &lt;cmath&gt;<br />#include &lt;algorithm&gt;<br />#include &lt;numeric&gt;<br />#include &lt;fstream&gt;<br />#include &lt;sstream&gt;<br />#include &lt;functional&gt;</div>
<div>double myfunction(double num) {<br />&nbsp;&nbsp;&nbsp; return exp(num);<br />}</div>
<div>template &lt;typename T&gt;<br />void softmax(const typename::std::vector&lt;T&gt; &amp;v, typename::std::vector&lt;T&gt; &amp;s) {<br />&nbsp;&nbsp;&nbsp; double sum=0.0;<br />&nbsp;&nbsp;&nbsp; transform(v.begin(), v.end(), s.begin(), myfunction);<br />&nbsp;&nbsp;&nbsp; sum=accumulate(s.begin(), s.end(), sum);<br />&nbsp;&nbsp;&nbsp; for(size_t i=0; i&lt;s.size(); ++i)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s.at(i)/=sum;<br />}</div>
<div>template &lt;typename T&gt;<br />void hypothesis(const std::vector&lt;std::vector&lt;T&gt; &gt; &amp;theta, const std::vector&lt;T&gt; &amp;feature, std::vector&lt;T&gt; &amp;prb) {<br />&nbsp;&nbsp;&nbsp; prb.clear();<br />&nbsp;&nbsp;&nbsp; double sum=0.0;<br />&nbsp;&nbsp;&nbsp; for(size_t i=0; i&lt;theta.size(); ++i) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double inner=0.0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner=inner_product(theta.at(i).begin(), theta.at(i).end(), feature.begin(), inner);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner=exp(inner);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum+=inner;<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; for(size_t i=0; i&lt;theta.size(); ++i) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double inner=0.0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner=inner_product(theta.at(i).begin(), theta.at(i).end(), feature.begin(), inner);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner=exp(inner);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; prb.push_back(inner/sum);<br />&nbsp;&nbsp;&nbsp; }<br />}</div>
<div>double stringtodouble(const std::string&amp; s) {<br />&nbsp;&nbsp;&nbsp; std::istringstream iss(s);<br />&nbsp;&nbsp;&nbsp; double num;<br />&nbsp;&nbsp;&nbsp; return iss&gt;&gt;num?num:0;<br />}</div>
<div>int indicator(const int &amp;a, const int &amp;b) {<br />&nbsp;&nbsp;&nbsp; if(a==b)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 1;<br />&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;<br />}</div>
<div>void print(int i) {<br />&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;i&lt;&lt;" ";<br />}</div>
<div>double CostFunc(const std::vector&lt;std::vector&lt;double&gt; &gt; &amp;vv_iris, const std::vector&lt;std::vector&lt;double&gt; &gt; &amp;theta) {<br />&nbsp;&nbsp;&nbsp; double sum3=0.0;<br />&nbsp;&nbsp;&nbsp; for(size_t i=0; i&lt;vv_iris.size(); ++i) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double sum1=0.0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int k;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(size_t j=0; j&lt;theta.size(); ++j) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double inner=0.0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int b=j+1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int indi=indicator(vv_iris.at(i).back(), b);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(indi)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; k=j; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner=inner_product(vv_iris.at(i).begin(), vv_iris.at(i).end()-1, theta.at(j).begin(), inner);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum1+=exp(inner);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum1=log(sum1);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double inner=0.0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner=inner_product(vv_iris.at(i).begin(), vv_iris.at(i).end()-1, theta.at(k).begin(), inner);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner-=sum1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum3+=inner;<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; sum3/=vv_iris.size();</div>
<div>&nbsp;&nbsp;&nbsp; return -sum3;<br />}</div>
<div>void GetThetaGrad(const std::vector&lt;std::vector&lt;double&gt; &gt; &amp;vv_iris, const std::vector&lt;std::vector&lt;double&gt; &gt; &amp;theta, const int j, std::vector&lt;double&gt; &amp;grad_theta) { <br />&nbsp;&nbsp;&nbsp; double sum=0.0;<br />&nbsp;&nbsp;&nbsp; for(size_t i=0; i&lt;vv_iris.size(); ++i) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double sum1=0.0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(size_t k=0; k&lt;theta.size(); ++k) { <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double inner=0.0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner=inner_product(vv_iris.at(i).begin(), vv_iris.at(i).end()-1, theta.at(k).begin(), inner);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner=exp(inner);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum1+=inner;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double inner=0.0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner=inner_product(vv_iris.at(i).begin(), vv_iris.at(i).end()-1, theta.at(j).begin(), inner);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner=exp(inner);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum1=(-1)*inner/sum1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int b=j+1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int indi=indicator(vv_iris.at(i).back(), b);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum1+=indi;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::vector&lt;double&gt; v_temp(theta.front().size(), 0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; transform(vv_iris.at(i).begin(), vv_iris.at(i).end()-1, v_temp.begin(), std::bind1st(std::multiplies&lt;double&gt;(), sum1));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(size_t l=0; l&lt;theta.front().size(); ++l) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; grad_theta.at(l)+=v_temp.at(l);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; for(size_t i=0; i&lt;grad_theta.size(); ++i) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; grad_theta.at(i)=(-1)*grad_theta.at(i)/vv_iris.size();<br />&nbsp;&nbsp;&nbsp; }<br />}</div>
<div>void ReadDataFromCsv(std::string &amp;filename, std::vector&lt;std::vector&lt;double&gt; &gt; &amp;lines_feat) {<br />&nbsp;&nbsp;&nbsp; std::ifstream vm_info(filename.c_str());<br />&nbsp;&nbsp;&nbsp; std::string lines, var;<br />&nbsp;&nbsp;&nbsp; std::vector&lt;double&gt; row;</div>
<div>&nbsp;&nbsp;&nbsp; lines_feat.clear();</div>
<div>&nbsp;&nbsp;&nbsp; while(!vm_info.eof()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getline(vm_info, lines);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(lines.empty())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::istringstream stringin(lines);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; row.clear();</div>
<div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; row.push_back(1);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while(std::getline(stringin, var, ',')) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(var=="Iris-setosa")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var="1";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if(var=="Iris-versicolor")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var="2";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if(var=="Iris-virginica")<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var="3";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double value=stringtodouble(var);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; row.push_back(value);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lines_feat.push_back(row);<br />&nbsp;&nbsp;&nbsp; }<br />}</div>
<div>template &lt;class DataType&gt;<br />void ReadMatFromFile(std::string &amp;filename, std::vector&lt;std::vector&lt;DataType&gt; &gt; &amp;lines_feat) {<br />&nbsp;&nbsp;&nbsp; std::ifstream vm_info(filename.c_str());<br />&nbsp;&nbsp;&nbsp; std::string lines;<br />&nbsp;&nbsp;&nbsp; DataType var;<br />&nbsp;&nbsp;&nbsp; std::vector&lt;DataType&gt; row;</div>
<div>&nbsp;&nbsp;&nbsp; lines_feat.clear();</div>
<div>&nbsp;&nbsp;&nbsp; while(!vm_info.eof()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getline(vm_info, lines);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(lines.empty())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::replace(lines.begin(), lines.end(), ',', ' ');<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::stringstream stringin(lines);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; row.clear();</div>
<div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while(stringin &gt;&gt; var) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; row.push_back(var);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lines_feat.push_back(row);<br />&nbsp;&nbsp;&nbsp; }<br />}</div>
<div>template &lt;class T&gt;<br />void Display2DVector(std::vector&lt;std::vector&lt;T&gt; &gt; &amp;vv) {<br />&nbsp;&nbsp;&nbsp; for(size_t i=0;i&lt;vv.size();++i) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(typename::std::vector&lt;T&gt;::const_iterator it=vv.at(i).begin();it!=vv.at(i).end();++it) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;*it&lt;&lt;" ";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"\n";<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"--------the total rows of the 2DVector is "&lt;&lt;vv.size()&lt;&lt;std::endl;<br />&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"--------the total cols of the 2DVector is "&lt;&lt;vv.front().size()&lt;&lt;std::endl;<br />}</div>
<div>int main() {<br />&nbsp;&nbsp;&nbsp; std::string file("Iris.csv"), weight("theta.csv");;<br />&nbsp;&nbsp;&nbsp; std::vector&lt;std::vector&lt;double&gt; &gt; vv_iris;<br />&nbsp;&nbsp;&nbsp; std::vector&lt;std::vector&lt;double&gt; &gt; theta;</div>
<div>&nbsp;&nbsp;&nbsp; ReadDataFromCsv(file, vv_iris);<br />&nbsp;&nbsp;&nbsp; ReadMatFromFile(weight, theta);</div>
<div>&nbsp;&nbsp;&nbsp; Display2DVector(vv_iris);<br />&nbsp;&nbsp;&nbsp; Display2DVector(theta);</div>
<div>&nbsp;&nbsp;&nbsp; double old_cost=CostFunc(vv_iris, theta);<br />&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"the orignal cost: "&lt;&lt;old_cost&lt;&lt;std::endl;</div>
<div>&nbsp;&nbsp;&nbsp; for(;;) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(size_t i=0; i&lt;theta.size(); ++i) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::vector&lt;double&gt; grad_theta(theta.front().size(), 0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GetThetaGrad(vv_iris, theta, i, grad_theta);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(size_t j=0; j&lt;grad_theta.size(); ++j) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; theta.at(i).at(j)=theta.at(i).at(j)-0.05*grad_theta.at(j);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double new_cost=CostFunc(vv_iris, theta);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout&lt;&lt;"new_cost: "&lt;&lt;new_cost&lt;&lt;std::endl;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(fabs(new_cost-old_cost)&lt;0.000000001)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; old_cost=new_cost;<br />&nbsp;&nbsp;&nbsp; }</div>
<div>&nbsp;&nbsp;&nbsp; Display2DVector(theta);</div>
<div>&nbsp;&nbsp;&nbsp; return 0;<br />}</div>

</div>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>