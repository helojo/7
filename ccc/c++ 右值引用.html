<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修c++ 右值引用' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>c++ 右值引用</center></div><div class='banquan'>原文出处:本文由博客园博主孔胡子提供。<br/>
原文连接:https://www.cnblogs.com/KongHuZi/p/11608061.html</div><br>
    <h1>1. 左值和右值</h1>
<p>　　简单的定义来说，能够放在赋值等号左边的就是左值，反之则是右值（所有表达式不是左值就是右值，左右值不存在交集）&mdash;&mdash;但是这个解释实在有点鸡肋。下面对定义结合例子做些补充。</p>
<ul>
<li><strong>右值</strong>：在内存中<span style="background-color: #ffff00;">不占有</span>内存的表达式</li>
<li><strong>左值</strong>：在内存中<span style="background-color: #ffff00;">占有</span>一定内存位置的表达式</li>
</ul>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> i;
</span><span style="color: #008080;">2</span> i = <span style="color: #800080;">2</span><span style="color: #000000;">; //合法
</span><span style="color: #008080;">3</span> <span style="color: #800080;">2</span> = i; //非法</pre>
</div>
<p>　　例子合法性很好理解&mdash;&mdash;可以在结合左右值的定义。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> #include&lt;iostream&gt;
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> main()
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">int</span><span style="color: #000000;"> t;
</span><span style="color: #008080;"> 5</span>     <span style="color: #000000;">int* q = &amp;(t + 1);</span><span style="color: #008000;">//</span><span style="color: #008000;">非法，t+1在内存中没有位置</span>
<span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">int</span> arr[] = { <span style="color: #800080;">1</span>,<span style="color: #800080;">2</span>,<span style="color: #800080;">3</span><span style="color: #000000;"> }; <span style="color: #0000ff;">int r[] = { <span style="color: #800080;">1,<span style="color: #800080;">2,<span style="color: #800080;">3<span style="color: #000000;"> };</span></span></span></span></span>
</span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">int</span>* i = arr; <span style="color: #008000;">//</span><span style="color: #008000;">合法</span>
<span style="color: #008080;"> 9</span>     std::cout &lt;&lt; arr &lt;&lt; std::endl; <span style="color: #008000;">//</span><span style="color: #008000;"> 006FF808
</span><span style="color: #008080;">10</span>     <span style="color: #000000;">arr = r; </span><span style="color: #008000;">//</span><span style="color: #008000;"> 非法</span>
<span style="color: #008080;">11</span>     *(arr) = <span style="color: #800080;">10</span>;<span style="color: #008000;">//</span><span style="color: #008000;">合法</span>
<span style="color: #008080;">12</span> }</pre>
</div>
<p>　　在这里，我们需要理解下第八行，arr 作为右值&mdash;&mdash;<strong> 注意 arr 是内存地址，是一个地址，不同于第一个例子中的 i</strong> 。在第九行可以看到打印的 arr 代表的地址内容，第十行也就必定是错误的（是右值就不可能作为左值）。</p>
<p>　　而第11行，arr 貌似变成了左值&mdash;&mdash;<strong>也就是左值和右值在一定程度上是可以转换的</strong>。其中扮演关键角色的就是 * 解引用。既然是左值，按照我们前面说的，那应该在内存中存在一处分配的内存位置，*arr 解引用之后的确是存了 1 这个数，所以可以重新赋值10。</p>
<p>&nbsp;</p>
<h1>2. 右值引用</h1>
<p>　　通过下面的例子来理解：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> #include&lt;iostream&gt;
<span style="color: #008080;"> 2</span> #include&lt;<span style="color: #0000ff;">string</span>&gt;
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">struct</span><span style="color: #000000;"> A
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 6</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 构造函数</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">explicit</span> A(size_t _size = <span style="color: #800080;">0</span>) :size(_size),ptr(<span style="color: #0000ff;">new</span> <span style="color: #0000ff;">int</span><span style="color: #000000;">[_size]()) {
</span><span style="color: #008080;"> 8</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">construct...</span><span style="color: #800000;">"</span>&lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 拷贝赋值运算符</span>
<span style="color: #008080;">12</span>     A&amp; <span style="color: #0000ff;">operator</span>=(<span style="color: #0000ff;">const</span> A&amp;<span style="color: #000000;"> tmp) {
</span><span style="color: #008080;">13</span>         <span style="color: #0000ff;">if</span> (&amp;tmp != <span style="color: #0000ff;">this</span><span style="color: #000000;">)
</span><span style="color: #008080;">14</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">15</span>             <span style="color: #0000ff;">this</span>-&gt;ptr = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">int</span><span style="color: #000000;">[tmp.size];
</span><span style="color: #008080;">16</span>             <span style="color: #0000ff;">for</span> (size_t i = <span style="color: #800080;">0</span>; i &lt; tmp.size; ++<span style="color: #000000;">i) {
</span><span style="color: #008080;">17</span>                 <span style="color: #0000ff;">this</span>-&gt;ptr[i] =<span style="color: #000000;"> tmp.ptr[i];
</span><span style="color: #008080;">18</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">19</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">20</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">copy assignment 等于...</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">21</span>         <span style="color: #0000ff;">return</span> *<span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">22</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 拷贝构造函数</span>
<span style="color: #008080;">25</span>      A(<span style="color: #0000ff;">const</span> A&amp;<span style="color: #000000;"> tmp) {
</span><span style="color: #008080;">26</span>         <span style="color: #0000ff;">this</span>-&gt;ptr = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">int</span><span style="color: #000000;">[tmp.size];
</span><span style="color: #008080;">27</span>         <span style="color: #0000ff;">for</span> (size_t i = <span style="color: #800080;">0</span>; i &lt; tmp.size; ++<span style="color: #000000;">i) {
</span><span style="color: #008080;">28</span>             <span style="color: #0000ff;">this</span>-&gt;ptr[i] =<span style="color: #000000;"> tmp.ptr[i];
</span><span style="color: #008080;">29</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">30</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">copy construct...</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">31</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">32</span> 
<span style="color: #008080;">33</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 析构函数</span>
<span style="color: #008080;">34</span>     ~<span style="color: #000000;">A() {
</span><span style="color: #008080;">35</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (ptr) 
</span><span style="color: #008080;">36</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">37</span>             <span style="color: #0000ff;">delete</span><span style="color: #000000;">[] ptr;
</span><span style="color: #008080;">38</span>             size = <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;">39</span>             cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">destructor...</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">40</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">41</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">42</span> 
<span style="color: #008080;">43</span> <span style="color: #0000ff;">private</span><span style="color: #000000;">:
</span><span style="color: #008080;">44</span>     <span style="color: #0000ff;">int</span>*<span style="color: #000000;"> ptr;
</span><span style="color: #008080;">45</span> <span style="color: #000000;">    size_t size;
</span><span style="color: #008080;">46</span> <span style="color: #000000;">};
</span><span style="color: #008080;">47</span> 
<span style="color: #008080;">48</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> main()
</span><span style="color: #008080;">49</span> <span style="color: #000000;">{
</span><span style="color: #008080;">50</span>     A a(<span style="color: #800080;">10</span><span style="color: #000000;">);
</span><span style="color: #008080;">51</span> <span style="color: #000000;">    A b;
</span><span style="color: #008080;">52</span> 
<span style="color: #008080;">53</span>     cout&lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">=====start=====</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;">endl;
</span><span style="color: #008080;">54</span>     b =<span style="color: #000000;"> a;
</span><span style="color: #008080;">55</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">=====end=====</span><span style="color: #800000;">"</span> &lt;&lt; endl &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">56</span> 
<span style="color: #008080;">57</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">=====start2=====</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">58</span>     A c = a;<span style="color: #008000;">//</span><span style="color: #008000;">是拷贝构造。或者加上explicit改成A c(a) 可能更好理解</span>
<span style="color: #008080;">59</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">=====end2=====</span><span style="color: #800000;">"</span> &lt;&lt; endl &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">60</span> 
<span style="color: #008080;">61</span> <span style="color: #000000;">    A d;
</span><span style="color: #008080;">62</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">=====start3=====</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">63</span>     d =<span style="color: #000000;"> A(5);
</span><span style="color: #008080;">64</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">=====end3=====</span><span style="color: #800000;">"</span> &lt;&lt; endl &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">65</span> 
<span style="color: #008080;">66</span>     <span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;">67</span> }</pre>
</div>
<p><img src="./images/c++ 右值引用0.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;　　结果上看，应该都比较好理解。</p>
<p>　　其中第三处是要引出的重点，可以看到应该使用了 <span style="background-color: #ffff00;">d = A（10）</span>，这条语句，A() 是一个临时变量，在完成 construct -&gt; copy assignment 之后就进行了 destructor。我们来讨论下这一句赋值语句的内部过程，A(10) 调用构造函数并申请了内存空间，然后去实现拷贝赋值运算符，临时变量A(10)的内容【copy】给 d 变量，随后 A(10) 被销毁。而我们知道在 copy assignment （拷贝赋值运算符）方法中，我们又为 d 变量同样申请了 大小为10的数组空间，这就出现了一定的&ldquo;低效处理&rdquo;。<span style="color: #ff0000; background-color: #ffff00;">不妨这样想，如果我们将A(10)申请的空间，通过拷贝赋值运算符，直接将这个空间给变量d，这样d就不用再去申请空间</span>（反正A(10)的空间申请了，马上就会释放。相当于白白多申请和释放了一次，<span style="background-color: #ffff00; color: #ff0000;">不如直接将A(10)的空间转移到d变量名下</span>）。</p>
<p>　　这就引入了右值引用，如下例子：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> #include&lt;iostream&gt;
<span style="color: #008080;"> 2</span> #include&lt;<span style="color: #0000ff;">string</span>&gt;
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">struct</span><span style="color: #000000;"> A
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 6</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 构造函数</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">explicit</span> A(size_t _size = <span style="color: #800080;">0</span>) :size(_size),ptr(<span style="color: #0000ff;">new</span> <span style="color: #0000ff;">int</span><span style="color: #000000;">[_size]()) {
</span><span style="color: #008080;"> 8</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">construct...</span><span style="color: #800000;">"</span>&lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 拷贝赋值运算符</span>
<span style="color: #008080;">12</span>     A&amp; <span style="color: #0000ff;">operator</span>=(<span style="color: #0000ff;">const</span> A&amp;<span style="color: #000000;"> tmp) {
</span><span style="color: #008080;">13</span>         <span style="color: #0000ff;">if</span> (&amp;tmp != <span style="color: #0000ff;">this</span><span style="color: #000000;">)
</span><span style="color: #008080;">14</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">15</span>             <span style="color: #0000ff;">this</span>-&gt;ptr = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">int</span><span style="color: #000000;">[tmp.size];
</span><span style="color: #008080;">16</span>             <span style="color: #0000ff;">for</span> (size_t i = <span style="color: #800080;">0</span>; i &lt; tmp.size; ++<span style="color: #000000;">i) {
</span><span style="color: #008080;">17</span>                 <span style="color: #0000ff;">this</span>-&gt;ptr[i] =<span style="color: #000000;"> tmp.ptr[i];
</span><span style="color: #008080;">18</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">19</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">20</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">copy assignment 等于...</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">21</span>         <span style="color: #0000ff;">return</span> *<span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">22</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span>     <span style="color: #ff0000; background-color: #ffff00;">//</span><span style="color: #ff0000; background-color: #ffff00;"> 使用右值引用的拷贝赋值运算符</span>
<span style="color: #008080;">25</span>     A&amp; <span style="color: #0000ff;">operator</span>=(A&amp;&amp;<span style="color: #000000;"> tmp) {
</span><span style="color: #008080;">26</span>         <span style="color: #0000ff;">if</span> (&amp;tmp != <span style="color: #0000ff;">this</span><span style="color: #000000;">)
</span><span style="color: #008080;">27</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">28</span>             <strong><span style="color: #0000ff;">this</span>-&gt;ptr =<span style="color: #000000;"> tmp.ptr;
</span></strong><span style="color: #008080;">29</span>             <strong><span style="color: #0000ff;">this</span>-&gt;size =<span style="color: #000000;"> tmp.size;
</span></strong><span style="color: #008080;">30</span> 
<span style="color: #008080;">31</span>             <span style="color: #ff0000;">tmp.ptr = nullptr;
</span><span style="color: #008080;">32</span>             <span style="color: #ff0000;">tmp.size = 0;
</span><span style="color: #008080;">33</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">34</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">copy assignment 等于2...</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">35</span>         <span style="color: #0000ff;">return</span> *<span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">36</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">37</span> 
<span style="color: #008080;">38</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 拷贝构造函数</span>
<span style="color: #008080;">39</span>      A(<span style="color: #0000ff;">const</span> A&amp;<span style="color: #000000;"> tmp) {
</span><span style="color: #008080;">40</span>         <span style="color: #0000ff;">this</span>-&gt;ptr = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">int</span><span style="color: #000000;">[tmp.size];
</span><span style="color: #008080;">41</span>         <span style="color: #0000ff;">for</span> (size_t i = <span style="color: #800080;">0</span>; i &lt; tmp.size; ++<span style="color: #000000;">i) {
</span><span style="color: #008080;">42</span>             <span style="color: #0000ff;">this</span>-&gt;ptr[i] =<span style="color: #000000;"> tmp.ptr[i];
</span><span style="color: #008080;">43</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">44</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">copy construct...</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">45</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">46</span> 
<span style="color: #008080;">47</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 析构函数</span>
<span style="color: #008080;">48</span>     ~<span style="color: #000000;">A() {
</span><span style="color: #008080;">49</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (ptr) 
</span><span style="color: #008080;">50</span> <span style="color: #000000;">        {
</span><span style="color: #008080;">51</span>             <span style="color: #0000ff;">delete</span><span style="color: #000000;">[] ptr;
</span><span style="color: #008080;">52</span>             size = <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;">53</span>             cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">destructor...</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">54</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">55</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">56</span> 
<span style="color: #008080;">57</span> <span style="color: #0000ff;">private</span><span style="color: #000000;">:
</span><span style="color: #008080;">58</span>     <span style="color: #0000ff;">int</span>*<span style="color: #000000;"> ptr;
</span><span style="color: #008080;">59</span> <span style="color: #000000;">    size_t size;
</span><span style="color: #008080;">60</span> <span style="color: #000000;">};
</span><span style="color: #008080;">61</span> 
<span style="color: #008080;">62</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> main()
</span><span style="color: #008080;">63</span> <span style="color: #000000;">{
</span><span style="color: #008080;">64</span>     A a(<span style="color: #800080;">10</span><span style="color: #000000;">);
</span><span style="color: #008080;">65</span> <span style="color: #000000;">    A b;
</span><span style="color: #008080;">66</span> 
<span style="color: #008080;">67</span>     cout&lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">=====start=====</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;">endl;
</span><span style="color: #008080;">68</span>     b =<span style="color: #000000;"> a;
</span><span style="color: #008080;">69</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">=====end=====</span><span style="color: #800000;">"</span> &lt;&lt; endl &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">70</span> 
<span style="color: #008080;">71</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">=====start2=====</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">72</span>     A c = a;<span style="color: #008000;">//</span><span style="color: #008000;">是拷贝构造。或者加上explicit改成A c(a) 可能更好理解</span>
<span style="color: #008080;">73</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">=====end2=====</span><span style="color: #800000;">"</span> &lt;&lt; endl &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">74</span> 
<span style="color: #008080;">75</span> <span style="color: #000000;">    A d;
</span><span style="color: #008080;">76</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">=====start3=====</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">77</span>     d = A(<span style="color: #800080;">10</span><span style="color: #000000;">);
</span><span style="color: #008080;">78</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">=====end3=====</span><span style="color: #800000;">"</span> &lt;&lt; endl &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">79</span> 
<span style="color: #008080;">80</span>     <span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;">81</span> }</pre>
</div>
<p><img src="./images/c++ 右值引用1.png" alt="" /></p>
<p>&nbsp;　　可以看到通过使用右值引用，执行一样的 d = A（5）操作会调用右值引用的拷贝运算符方法。这样写就能达到如下效果：<span style="background-color: #ffff00;">A(5)申请了临时空间，但是这空间通过拷贝运算符方法（右值引用）直接被 d 变量接管，d 变量无需再去申请空间了</span>。<span style="color: #ff0000;">注意</span>：第31，32行代码不能不写，经过28，29行之后，d 变量和 A(5) 临时变量的指针都指向了同一块内存，而之后 A(5) 将被销毁，所以需要将 A(5) 的指针置为 nullptr，但这部分内存由 d 对象接管。<span style="color: #ff0000;">注意</span>：这里看上去好像少了临时变量 A(5) destructor（没有打印），其实对象 A(5) 也是执行了析构，析构时释放这个类&mdash;&mdash;也就是临时A(5)这个类，但是因为我析构函数有个if条件，所以只是看上去没有打印罢了，反正依旧会执行析构。</p>
<p>&nbsp;</p>
<h1>3. std::move()</h1>
<p>&nbsp;　　我们先看下面的例子：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> #include&lt;iostream&gt;
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;
</span><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">void</span> f(<span style="color: #0000ff;">int</span>&amp;&amp;<span style="color: #000000;"> i) {
</span><span style="color: #008080;"> 4</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">右值引用</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">void</span> f(<span style="color: #0000ff;">int</span>&amp;<span style="color: #000000;"> i) {
</span><span style="color: #008080;"> 8</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">左值引用</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">}
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> <span style="color: #0000ff;">int</span> main()
<span style="color: #008080;">12</span> <span style="color: #000000;">{
</span><span style="color: #008080;">13</span>     f(<span style="color: #800080;">4</span>); <span style="color: #008000;">//</span><span style="color: #008000;"> 右值引用</span>
<span style="color: #008080;">14</span>     <span style="color: #0000ff;">int</span> i = <span style="color: #800080;">3</span><span style="color: #000000;">;
</span><span style="color: #008080;">15</span>     f(i); <span style="color: #008000;">//</span><span style="color: #008000;"> 左值引用</span>
<span style="color: #008080;">16</span>     f(<span style="color: #0000ff;">int</span>());<span style="color: #008000;">//</span><span style="color: #008000;"> 右值引用.int() 调用默认构造函数，返回 0 值</span>
<span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span>     <span style="background-color: #ffff00;">f(std::move(i)); </span> <span style="color: #008000; background-color: #ffff00;">//</span><span style="color: #008000; background-color: #ffff00;"> 右值引用</span>
<span style="color: #008080;">19</span>     f(std::move(3)); <span style="color: #008000;">//<span style="color: #008000;"> 左值引用</span></span>
<span style="color: #008080;">20</span> }</pre>
</div>
<p>　　因为我们已经知道了如果分辨左值和右值，所以输出应该都在意料之内。</p>
<p>　　但是请比较第15行 和 第18行，可以看到同一个变量 i 怎么还能输出不同的结果？其中的关键就是 std::move()，<span style="color: #ff0000;">请注意</span>：s<span style="background-color: #ffff00;">td::move() 并不是如上文提到的<span style="color: #ff0000;">内存接管</span>，而是将 左值-&gt;变换成-&gt; 右值。</span></p>
<h2>3.1 实例一：移动构造函数　</h2>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> #include&lt;iostream&gt;
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;
</span><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Test
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">public</span><span style="color: #000000;">:
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    Test()
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 8</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">constructor </span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span>     Test(<span style="color: #0000ff;">const</span> Test&amp;<span style="color: #000000;"> t)
</span><span style="color: #008080;">12</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">13</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">copy constructor </span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">14</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span>     Test&amp; <span style="color: #0000ff;">operator</span> = (<span style="color: #0000ff;">const</span> Test&amp;<span style="color: #000000;"> t)
</span><span style="color: #008080;">17</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">18</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">copy = constructor</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl; return *this;
</span><span style="color: #008080;">19</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">20</span> 
<span style="color: #008080;">21</span>     Test(Test&amp;&amp;<span style="color: #000000;"> t)   
</span><span style="color: #008080;">22</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">23</span>          cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">move constructor</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">24</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">25</span> 
<span style="color: #008080;">26</span>     Test&amp; <span style="color: #0000ff;">operator</span> =(Test&amp;&amp;<span style="color: #000000;"> t)
</span><span style="color: #008080;">27</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">28</span> 
<span style="color: #008080;">29</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">move = constructor</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl; return *this;
</span><span style="color: #008080;">30</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">31</span> 
<span style="color: #008080;">32</span>     ~<span style="color: #000000;">Test()
</span><span style="color: #008080;">33</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">34</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">destructor </span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">35</span> 
<span style="color: #008080;">36</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">37</span> <span style="color: #000000;">};
</span><span style="color: #008080;">38</span> 
<span style="color: #008080;">39</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> main()
</span><span style="color: #008080;">40</span> <span style="color: #000000;">{
</span><span style="color: #008080;">41</span> <span style="color: #000000;">    Test a;
</span><span style="color: #008080;">42</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">start </span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">43</span>     Test b =<span style="color: #000000;"> std::move(a);  
</span><span style="color: #008080;">44</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">end </span><span style="color: #800000;">"</span> &lt;&lt; endl &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">45</span> 
<span style="color: #008080;">46</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">start2 </span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">47</span>     Test c =<span style="color: #000000;"> a;   
</span><span style="color: #008080;">48</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">end2 </span><span style="color: #800000;">"</span> &lt;&lt; endl &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">49</span>     <span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;">50</span> }</pre>
</div>
<p>　<img src="./images/c++ 右值引用2.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;　<span style="color: #ff0000;">注意</span>：如果没有 21~24行的移动构造函数，则结果如下，再构造 Test b 的时候会使用赋值构造函数</p>
<p><img src="./images/c++ 右值引用3.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>3.2 实例二 移动赋值函数</h2>
<p>　　改变main 函数中的两句话：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> #include&lt;iostream&gt;
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;
</span><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Test
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">{
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">public</span><span style="color: #000000;">:
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    Test()
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    {
</span><span style="color: #008080;"> 8</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">constructor </span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span>     Test(<span style="color: #0000ff;">const</span> Test&amp;<span style="color: #000000;"> t)
</span><span style="color: #008080;">12</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">13</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">copy constructor </span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">14</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span>     Test&amp; <span style="color: #0000ff;">operator</span> = (<span style="color: #0000ff;">const</span> Test&amp;<span style="color: #000000;"> t)
</span><span style="color: #008080;">17</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">18</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">copy = constructor</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">19</span>         <span style="color: #0000ff;">return</span> *<span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">20</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span>     Test(Test&amp;&amp;<span style="color: #000000;"> t)   
</span><span style="color: #008080;">23</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">24</span>          cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">move constructor</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">25</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">26</span> 
<span style="color: #008080;">27</span>     Test&amp; <span style="color: #0000ff;">operator</span> =(Test&amp;&amp;<span style="color: #000000;"> t)
</span><span style="color: #008080;">28</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">move = constructor</span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">31</span>         <span style="color: #0000ff;">return</span> *<span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">32</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">33</span> 
<span style="color: #008080;">34</span>     ~<span style="color: #000000;">Test()
</span><span style="color: #008080;">35</span> <span style="color: #000000;">    {
</span><span style="color: #008080;">36</span>         cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">destructor </span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">37</span> 
<span style="color: #008080;">38</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">39</span> <span style="color: #000000;">};
</span><span style="color: #008080;">40</span> 
<span style="color: #008080;">41</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> main()
</span><span style="color: #008080;">42</span> <span style="color: #000000;">{
</span><span style="color: #008080;">43</span> <span style="color: #000000;">    Test a;
</span><span style="color: #008080;">44</span> <span style="color: #000000;">    Test b;
</span><span style="color: #008080;">45</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">start </span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">46</span>     b =<span style="color: #000000;"> std::move(a);
</span><span style="color: #008080;">47</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">end </span><span style="color: #800000;">"</span> &lt;&lt; endl &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">48</span> 
<span style="color: #008080;">49</span> <span style="color: #000000;">    Test c;
</span><span style="color: #008080;">50</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">start2 </span><span style="color: #800000;">"</span> &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">51</span>     c =<span style="color: #000000;"> a;
</span><span style="color: #008080;">52</span>     cout &lt;&lt; <span style="color: #800000;">"</span><span style="color: #800000;">end2 </span><span style="color: #800000;">"</span> &lt;&lt; endl &lt;&lt;<span style="color: #000000;"> endl;
</span><span style="color: #008080;">53</span>     <span style="color: #0000ff;">return</span> <span style="color: #800080;">0</span><span style="color: #000000;">;
</span><span style="color: #008080;">54</span> }</pre>
</div>
<p><img src="./images/c++ 右值引用4.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>完结，撒花。*★,&deg;*:.☆(￣▽￣)/$:*.&deg;★* 。</p>
<p>&nbsp;</p>
<p>　</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>