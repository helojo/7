<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修C++结构体与Delphi结构体相互传参，结构体中包含结构体的嵌套，数组指针' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>C++结构体与Delphi结构体相互传参，结构体中包含结构体的嵌套，数组指针</center></div><div class='banquan'>原文出处:本文由博客园博主C#爆破提供。<br/>
原文连接:https://www.cnblogs.com/motao9527/p/10767280.html</div><br>
    <div class="cnblogs_code" onclick="cnblogs_code_show('51821e82-c0af-4570-970f-1abaa747a43e')"><span style="font-family: Microsoft YaHei;"><img id="code_img_closed_51821e82-c0af-4570-970f-1abaa747a43e" class="code_img_closed" src="./images/C++结构体与Delphi结构体相互传参，结构体中包含结构体的嵌套，数组指针0.png" alt="" /><img id="code_img_opened_51821e82-c0af-4570-970f-1abaa747a43e" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('51821e82-c0af-4570-970f-1abaa747a43e',event)" src="./images/C++结构体与Delphi结构体相互传参，结构体中包含结构体的嵌套，数组指针1.png" alt="" /></span>
<div id="cnblogs_code_open_51821e82-c0af-4570-970f-1abaa747a43e" class="cnblogs_code_hide">
<pre><code><span style="font-family: Microsoft YaHei;"><span style="color: #008000;">//</span><span style="color: #008000;">结构体的声明</span>
<span style="color: #000000;">

typedef </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Mwinddirectbaseline {
    </span><span style="color: #0000ff;">char</span>*<span style="color: #000000;"> p;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> s;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i;
}Mwinddirectbaseline;


typedef </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> F {
    </span><span style="color: #0000ff;">char</span>*<span style="color: #000000;"> p;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> s;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i;
}F;

typedef </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> H {
    </span><span style="color: #0000ff;">char</span>*<span style="color: #000000;"> p;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> s;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i;
}H;



typedef </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Coordinate1 {
    </span><span style="color: #0000ff;">char</span>*<span style="color: #000000;"> p;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> s;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i;
}Coordinate1;

typedef </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Mwinddirectbar {
    F f;
    H h;
}Mwinddirectbar;


typedef </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Huxianarray {
    </span><span style="color: #0000ff;">float</span>*<span style="color: #000000;"> Params;
}Huxianarray;

typedef </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Hengxianarray {
    </span><span style="color: #0000ff;">float</span>*<span style="color: #000000;"> Params;
}Hengxianarray;


typedef </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Windspeedline {
    </span><span style="color: #0000ff;">char</span>*<span style="color: #000000;"> types;
    Coordinate1</span>**<span style="color: #000000;"> coordinates;
}Windspeedline;


typedef </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Resultwindspeedgrid {
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> HuxianShu;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> HengxianShu;
    Huxianarray</span>*<span style="color: #000000;"> HuxianArrays;
    Hengxianarray</span>*<span style="color: #000000;"> HengxianArrays;
}Resultwindspeedgrid;


typedef </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Coordinate {
    Mwinddirectbaseline </span>*<span style="color: #000000;">mWindDirectBaseLine;
    Mwinddirectbar </span>*<span style="color: #000000;">mWindDirectBars;
}Coordinate;


typedef </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Winddirectline {
    Coordinate</span>*<span style="color: #000000;"> coordinates;
}Winddirectline;

</span><span style="color: #008000;">//</span><span style="color: #008000;">typedef struct Structtest {
</span><span style="color: #008000;">//</span><span style="color: #008000;">    int a;
</span><span style="color: #008000;">//</span><span style="color: #008000;">    int b;
</span><span style="color: #008000;">//</span><span style="color: #008000;">    int* arr;
</span><span style="color: #008000;">//</span><span style="color: #008000;">}Structtest;</span>
<span style="color: #000000;">

typedef </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> Rootobject {
    </span><span style="color: #0000ff;">char</span>*<span style="color: #000000;"> gridStartTime;
    </span><span style="color: #0000ff;">char</span>*<span style="color: #000000;"> gridEndTime;
    </span><span style="color: #0000ff;">char</span>*<span style="color: #000000;"> resultStartTime;
    </span><span style="color: #0000ff;">char</span>*<span style="color: #000000;"> resultEndTime;
    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> gridMethod;
    </span><span style="color: #0000ff;">char</span>*<span style="color: #000000;"> WindDirectBorder;
    Winddirectline WindDirectLine;
    </span><span style="color: #0000ff;">char</span>*<span style="color: #000000;"> WindSpeedBorder;
    Windspeedline WindSpeedLine;
    </span><span style="color: #008000;">/*</span><span style="color: #008000;">void* LineDateTimeRelations;
    void* RatioConverts;</span><span style="color: #008000;">*/</span>
    <span style="color: #008000;">//</span><span style="color: #008000;">void* 不确定类型</span>
    <span style="color: #0000ff;">char</span>*<span style="color: #000000;"> resultWindDirectGrid;
    Resultwindspeedgrid resultWindSpeedGrid;


}Rootobject;</span></span></pre>
</div>
<span class="cnblogs_code_collapse" style="font-family: Microsoft YaHei;">C++结构体的声明</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('c0b6012d-95a1-49ff-a467-91c94cfbaed4')"><span style="font-family: Microsoft YaHei;"><img id="code_img_closed_c0b6012d-95a1-49ff-a467-91c94cfbaed4" class="code_img_closed" src="./images/C++结构体与Delphi结构体相互传参，结构体中包含结构体的嵌套，数组指针0.png" alt="" /><img id="code_img_opened_c0b6012d-95a1-49ff-a467-91c94cfbaed4" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c0b6012d-95a1-49ff-a467-91c94cfbaed4',event)" src="./images/C++结构体与Delphi结构体相互传参，结构体中包含结构体的嵌套，数组指针1.png" alt="" /></span>
<div id="cnblogs_code_open_c0b6012d-95a1-49ff-a467-91c94cfbaed4" class="cnblogs_code_hide">
<pre><code><span style="font-family: Microsoft YaHei;">__declspec(dllexport) Rootobject __stdcall RefRootobjectValues(<span style="color: #0000ff;">char</span>*<span style="color: #000000;"> path)
{
    ifstream t(path);
    Rootobject Root;
    </span><span style="color: #0000ff;">string</span> str((istreambuf_iterator&lt;<span style="color: #0000ff;">char</span>&gt;(t)), istreambuf_iterator&lt;<span style="color: #0000ff;">char</span>&gt;<span style="color: #000000;">());
    CJsonObject Objson </span>=<span style="color: #000000;"> CJsonObject(str);
    </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> strsss;

    Objson.Get(</span><span style="color: #800000;">"</span><span style="color: #800000;">gridStartTime</span><span style="color: #800000;">"</span><span style="color: #000000;">, strsss);
    Root.gridStartTime </span>=<span style="color: #000000;"> ReturnCharArr(strsss);

    Objson.Get(</span><span style="color: #800000;">"</span><span style="color: #800000;">gridEndTime</span><span style="color: #800000;">"</span><span style="color: #000000;">, strsss);
    Root.gridEndTime </span>=<span style="color: #000000;"> ReturnCharArr(strsss);

    Objson.Get(</span><span style="color: #800000;">"</span><span style="color: #800000;">resultStartTime</span><span style="color: #800000;">"</span><span style="color: #000000;">, strsss);
    Root.resultStartTime </span>=<span style="color: #000000;"> ReturnCharArr(strsss);

    Objson.Get(</span><span style="color: #800000;">"</span><span style="color: #800000;">resultEndTime</span><span style="color: #800000;">"</span><span style="color: #000000;">, strsss);
    Root.resultEndTime </span>=<span style="color: #000000;"> ReturnCharArr(strsss);

    Objson.Get(</span><span style="color: #800000;">"</span><span style="color: #800000;">WindSpeedBorder</span><span style="color: #800000;">"</span><span style="color: #000000;">, strsss);
    Root.WindSpeedBorder </span>=<span style="color: #000000;"> ReturnCharArr(strsss);

    Objson.Get(</span><span style="color: #800000;">"</span><span style="color: #800000;">WindDirectBorder</span><span style="color: #800000;">"</span><span style="color: #000000;">, strsss);
    Root.WindDirectBorder </span>=<span style="color: #000000;"> ReturnCharArr(strsss);
    

    Objson.Get(</span><span style="color: #800000;">"</span><span style="color: #800000;">resultWindDirectGrid</span><span style="color: #800000;">"</span><span style="color: #000000;">, strsss);
    Root.resultWindDirectGrid </span>=<span style="color: #000000;"> ReturnCharArr(strsss);


    </span><span style="color: #0000ff;">int</span> nums = Objson[<span style="color: #800000;">"</span><span style="color: #800000;">WindDirectLine</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">coordinates</span><span style="color: #800000;">"</span><span style="color: #000000;">].GetArraySize();

    Root.WindDirectLine.coordinates </span>= (<span style="color: #0000ff;">struct</span> Coordinate *)<span style="color: #0000ff;">malloc</span>(nums * <span style="color: #0000ff;">sizeof</span>(<span style="color: #0000ff;">struct</span><span style="color: #000000;"> Coordinate));
    </span><span style="color: #008000;">/*</span><span style="color: #008000;">Coordinate* coor=new Coordinate [nums];</span><span style="color: #008000;">*/</span>
    <span style="color: #008000;">/*</span><span style="color: #008000;">由于School_T中定义的student是一个结构体指针，必须要对其进行分配内存</span><span style="color: #008000;">*/</span>
    <span style="color: #008000;">//</span><span style="color: #008000;">Root.WindDirectLine-&gt;coordinates = (coordinates *)malloc(sizeof(Student_T));</span>

    <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; nums; i++<span style="color: #000000;">)
    {
        </span><span style="color: #0000ff;">int</span> mWindDirectBaseLine_Length = Objson[<span style="color: #800000;">"</span><span style="color: #800000;">WindDirectLine</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">coordinates</span><span style="color: #800000;">"</span>][i][<span style="color: #800000;">"</span><span style="color: #800000;">mWindDirectBaseLine</span><span style="color: #800000;">"</span><span style="color: #000000;">].GetArraySize();
        Root.WindDirectLine.coordinates[i].mWindDirectBaseLine </span>= (<span style="color: #0000ff;">struct</span> Mwinddirectbaseline *)<span style="color: #0000ff;">malloc</span>(nums * <span style="color: #0000ff;">sizeof</span>(<span style="color: #0000ff;">struct</span><span style="color: #000000;"> Mwinddirectbaseline));
        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> j = <span style="color: #800080;">0</span>; j &lt; mWindDirectBaseLine_Length; j++<span style="color: #000000;">)
        {
            </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> Str1;
            Objson[</span><span style="color: #800000;">"</span><span style="color: #800000;">WindDirectLine</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">coordinates</span><span style="color: #800000;">"</span>][i][<span style="color: #800000;">"</span><span style="color: #800000;">mWindDirectBaseLine</span><span style="color: #800000;">"</span>][j].Get(<span style="color: #800000;">"</span><span style="color: #800000;">p</span><span style="color: #800000;">"</span><span style="color: #000000;">, Str1);
            Root.WindDirectLine.coordinates[i].mWindDirectBaseLine[j].p </span>=<span style="color: #000000;"> ReturnCharArr(Str1);
            Objson[</span><span style="color: #800000;">"</span><span style="color: #800000;">WindDirectLine</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">coordinates</span><span style="color: #800000;">"</span>][i][<span style="color: #800000;">"</span><span style="color: #800000;">mWindDirectBaseLine</span><span style="color: #800000;">"</span>][j].Get(<span style="color: #800000;">"</span><span style="color: #800000;">i</span><span style="color: #800000;">"</span><span style="color: #000000;">, Root.WindDirectLine.coordinates[i].mWindDirectBaseLine[j].i);
            Objson[</span><span style="color: #800000;">"</span><span style="color: #800000;">WindDirectLine</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">coordinates</span><span style="color: #800000;">"</span>][i][<span style="color: #800000;">"</span><span style="color: #800000;">mWindDirectBaseLine</span><span style="color: #800000;">"</span>][j].Get(<span style="color: #800000;">"</span><span style="color: #800000;">s</span><span style="color: #800000;">"</span><span style="color: #000000;">, Root.WindDirectLine.coordinates[i].mWindDirectBaseLine[j].s);
            Root.WindDirectLine.coordinates[i].mWindDirectBaseLine</span>++<span style="color: #000000;">;
        }

        </span><span style="color: #0000ff;">int</span> mWindDirectBars_Length = Objson[<span style="color: #800000;">"</span><span style="color: #800000;">WindDirectLine</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">coordinates</span><span style="color: #800000;">"</span>][i][<span style="color: #800000;">"</span><span style="color: #800000;">mWindDirectBars</span><span style="color: #800000;">"</span><span style="color: #000000;">].GetArraySize();
        Root.WindDirectLine.coordinates[i].mWindDirectBars </span>= (<span style="color: #0000ff;">struct</span> Mwinddirectbar *)<span style="color: #0000ff;">malloc</span>(nums * <span style="color: #0000ff;">sizeof</span>(<span style="color: #0000ff;">struct</span><span style="color: #000000;"> Mwinddirectbar));
        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> k = <span style="color: #800080;">0</span>; k &lt; mWindDirectBars_Length; k++<span style="color: #000000;">)
        {
            </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> Str2;
            F f;
            H h;
            Objson[</span><span style="color: #800000;">"</span><span style="color: #800000;">WindDirectLine</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">coordinates</span><span style="color: #800000;">"</span>][i][<span style="color: #800000;">"</span><span style="color: #800000;">mWindDirectBars</span><span style="color: #800000;">"</span>][k][<span style="color: #800000;">"</span><span style="color: #800000;">f</span><span style="color: #800000;">"</span>].Get(<span style="color: #800000;">"</span><span style="color: #800000;">p</span><span style="color: #800000;">"</span><span style="color: #000000;">, Str2);
            f.p </span>=<span style="color: #000000;"> ReturnCharArr(Str2);
            Objson[</span><span style="color: #800000;">"</span><span style="color: #800000;">WindDirectLine</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">coordinates</span><span style="color: #800000;">"</span>][i][<span style="color: #800000;">"</span><span style="color: #800000;">mWindDirectBars</span><span style="color: #800000;">"</span>][k][<span style="color: #800000;">"</span><span style="color: #800000;">f</span><span style="color: #800000;">"</span>].Get(<span style="color: #800000;">"</span><span style="color: #800000;">s</span><span style="color: #800000;">"</span><span style="color: #000000;">, f.s);
            Objson[</span><span style="color: #800000;">"</span><span style="color: #800000;">WindDirectLine</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">coordinates</span><span style="color: #800000;">"</span>][i][<span style="color: #800000;">"</span><span style="color: #800000;">mWindDirectBars</span><span style="color: #800000;">"</span>][k][<span style="color: #800000;">"</span><span style="color: #800000;">f</span><span style="color: #800000;">"</span>].Get(<span style="color: #800000;">"</span><span style="color: #800000;">i</span><span style="color: #800000;">"</span><span style="color: #000000;">, f.i);
            Str2 </span>= <span style="color: #800000;">""</span><span style="color: #000000;">;
            Objson[</span><span style="color: #800000;">"</span><span style="color: #800000;">WindDirectLine</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">coordinates</span><span style="color: #800000;">"</span>][i][<span style="color: #800000;">"</span><span style="color: #800000;">mWindDirectBars</span><span style="color: #800000;">"</span>][k][<span style="color: #800000;">"</span><span style="color: #800000;">h</span><span style="color: #800000;">"</span>].Get(<span style="color: #800000;">"</span><span style="color: #800000;">p</span><span style="color: #800000;">"</span><span style="color: #000000;">, Str2);
            h.p </span>=<span style="color: #000000;"> ReturnCharArr(Str2);
            Objson[</span><span style="color: #800000;">"</span><span style="color: #800000;">WindDirectLine</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">coordinates</span><span style="color: #800000;">"</span>][i][<span style="color: #800000;">"</span><span style="color: #800000;">mWindDirectBars</span><span style="color: #800000;">"</span>][k][<span style="color: #800000;">"</span><span style="color: #800000;">h</span><span style="color: #800000;">"</span>].Get(<span style="color: #800000;">"</span><span style="color: #800000;">s</span><span style="color: #800000;">"</span><span style="color: #000000;">, h.s);
            Objson[</span><span style="color: #800000;">"</span><span style="color: #800000;">WindDirectLine</span><span style="color: #800000;">"</span>][<span style="color: #800000;">"</span><span style="color: #800000;">coordinates</span><span style="color: #800000;">"</span>][i][<span style="color: #800000;">"</span><span style="color: #800000;">mWindDirectBars</span><span style="color: #800000;">"</span>][k][<span style="color: #800000;">"</span><span style="color: #800000;">h</span><span style="color: #800000;">"</span>].Get(<span style="color: #800000;">"</span><span style="color: #800000;">i</span><span style="color: #800000;">"</span><span style="color: #000000;">, h.i);
            Root.WindDirectLine.coordinates[i].mWindDirectBars[k].f </span>=<span style="color: #000000;"> f;
            Root.WindDirectLine.coordinates[i].mWindDirectBars[k].h </span>=<span style="color: #000000;"> h;
            Root.WindDirectLine.coordinates[i].mWindDirectBars</span>++<span style="color: #000000;">;
        }
        Root.WindDirectLine.coordinates</span>++<span style="color: #000000;">;
    }

    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> Root;
    </span><span style="color: #008000;">//</span><span style="color: #008000;">strs-&gt;WindDirectLine.coordinates = coor;
    </span><span style="color: #008000;">//</span><span style="color: #008000;">strs-&gt;WindDirectLine-&gt;coordinates = coor;
    </span><span style="color: #008000;">//</span><span style="color: #008000;">strs-&gt;gridMethod = 50;</span>
<span style="color: #000000;">
}</span></span></pre>
</div>
<span class="cnblogs_code_collapse" style="font-family: Microsoft YaHei;">C++赋值并返回</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('cd52bf72-7cfa-40e1-8f77-91a293a51fad')"><span style="font-family: Microsoft YaHei;"><img id="code_img_closed_cd52bf72-7cfa-40e1-8f77-91a293a51fad" class="code_img_closed" src="./images/C++结构体与Delphi结构体相互传参，结构体中包含结构体的嵌套，数组指针0.png" alt="" /><img id="code_img_opened_cd52bf72-7cfa-40e1-8f77-91a293a51fad" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('cd52bf72-7cfa-40e1-8f77-91a293a51fad',event)" src="./images/C++结构体与Delphi结构体相互传参，结构体中包含结构体的嵌套，数组指针1.png" alt="" /></span>
<div id="cnblogs_code_open_cd52bf72-7cfa-40e1-8f77-91a293a51fad" class="cnblogs_code_hide">
<pre><code><span style="font-family: Microsoft YaHei;"> <span style="color: #0000ff;">type</span><span style="color: #000000;">
    Huxianarray </span>= <span style="color: #0000ff;">record</span><span style="color: #000000;">
      Params:^ double;
    </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;

  </span><span style="color: #0000ff;">type</span><span style="color: #000000;">
    Hengxianarray  </span>= <span style="color: #0000ff;">record</span><span style="color: #000000;">
      Params:^ double;
    </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;

   </span><span style="color: #0000ff;">type</span><span style="color: #000000;">
    Resultwindspeedgrid </span>= <span style="color: #0000ff;">record</span><span style="color: #000000;">
       HuxianShu:Integer;
       HuxianArrays:^ Huxianarray;
       HengxianShu:Integer;
       HengxianArrays:^ Hengxianarray;
    </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;

   </span><span style="color: #0000ff;">type</span><span style="color: #000000;">
    Coordinate1 </span>= <span style="color: #0000ff;">record</span><span style="color: #000000;">
       p:pansiChar;
       s:Integer;
       i:Integer;
    </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;

   </span><span style="color: #0000ff;">type</span><span style="color: #000000;">
    Windspeedline </span>=  <span style="color: #0000ff;">record</span><span style="color: #000000;">
         types:pansiChar;
         coordinates:^ Coordinate1;
    </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;

    </span><span style="color: #0000ff;">type</span><span style="color: #000000;">
    H  </span>= <span style="color: #0000ff;">record</span><span style="color: #000000;">
        p:pansiChar;
        s:Integer;
        i:Integer;
    </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;

   </span><span style="color: #0000ff;">type</span><span style="color: #000000;">
    F </span>=  <span style="color: #0000ff;">record</span><span style="color: #000000;">
        p:pansiChar;
        s:Integer;
        i:Integer;
    </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;


   </span><span style="color: #0000ff;">type</span><span style="color: #000000;">
    Mwinddirectbar </span>= <span style="color: #0000ff;">record</span><span style="color: #000000;">
        f:F;
        h:H;
    </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;
    TMyArraybar </span>= <span style="color: #0000ff;">array</span> <span style="color: #0000ff;">of</span><span style="color: #000000;"> Mwinddirectbar;
    PMyArraybar </span>=<span style="color: #000000;"> ^TMyArraybar;

    </span><span style="color: #0000ff;">type</span><span style="color: #000000;">
    Mwinddirectbaseline  </span>= <span style="color: #0000ff;">record</span><span style="color: #000000;">
       p:pansiChar;
       s:Integer;
       i:Integer;
    </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;


    </span><span style="color: #0000ff;">type</span><span style="color: #000000;">
    Coordinate </span>= <span style="color: #0000ff;">record</span>
<span style="color: #008000;">//</span><span style="color: #008000;">    TCoordinate = record</span>
<span style="color: #000000;">         mWindDirectBaseLine: ^Mwinddirectbaseline;
         mWindDirectBars: ^Mwinddirectbar;
    </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;



   </span><span style="color: #0000ff;">type</span><span style="color: #000000;">
    Winddirectline  </span>= <span style="color: #0000ff;">record</span><span style="color: #000000;">
      coordinates: ^Coordinate;
    </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;

     </span><span style="color: #0000ff;">type</span><span style="color: #000000;">
    Rootobject </span>= <span style="color: #0000ff;">record</span><span style="color: #000000;">
         gridStartTime:pansiChar;
         gridEndTime:pansiChar;
         resultStartTime:pansiChar;
         resultEndTime:pansiChar;
         gridMethod:Integer;
         WindDirectBorder:pansiChar;
         WindDirectLine:Winddirectline;
         WindSpeedBorder:pansiChar;
         WindSpeedLine:Windspeedline;
</span><span style="color: #008000;">//</span><span style="color: #008000;">         LineDateTimeRelations:pointer;</span><span style="color: #008000;">
//</span><span style="color: #008000;">         RatioConverts:pointer;</span>
<span style="color: #000000;">         resultWindDirectGrid:pansiChar;
         resultWindSpeedGrid:Resultwindspeedgrid;
    </span><span style="color: #0000ff;">end</span>;</span></pre>
</div>
<span class="cnblogs_code_collapse" style="font-family: Microsoft YaHei;">Delphi结构体的声明</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('2c54ffe3-5778-484c-9217-9d4b514f6083')"><span style="font-family: Microsoft YaHei;"><img id="code_img_closed_2c54ffe3-5778-484c-9217-9d4b514f6083" class="code_img_closed" src="./images/C++结构体与Delphi结构体相互传参，结构体中包含结构体的嵌套，数组指针0.png" alt="" /><img id="code_img_opened_2c54ffe3-5778-484c-9217-9d4b514f6083" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('2c54ffe3-5778-484c-9217-9d4b514f6083',event)" src="./images/C++结构体与Delphi结构体相互传参，结构体中包含结构体的嵌套，数组指针1.png" alt="" /></span>
<div id="cnblogs_code_open_2c54ffe3-5778-484c-9217-9d4b514f6083" class="cnblogs_code_hide">
<pre><code><span style="font-family: Microsoft YaHei;"><span style="color: #0000ff;">function</span> RetRootobjectValues(b:pansiChar;<span style="color: #0000ff;">var</span> n1:pansiChar;<span style="color: #0000ff;">var</span> mu:Integer):Rootobject;<span style="color: #0000ff;">stdcall</span>;<span style="color: #0000ff;">external</span> <span style="color: #800000;">'</span><span style="color: #800000;">F:\资料文档\20190227\测试文件夹\Win32DLL\Debug\Win32DLL.dll</span><span style="color: #800000;">'</span><span style="color: #000000;">;

</span><span style="color: #0000ff;">procedure</span><span style="color: #000000;"> TForm5.Button4Click(Sender: TObject);
</span><span style="color: #0000ff;">var</span><span style="color: #000000;">
root:Rootobject;
path,res:pansiChar;
mu,I,hsf,hsh:Integer;
nums:Mwinddirectbaseline;
resd:Coordinate;
Mwind: Mwinddirectbaseline;
Mwbar:Mwinddirectbar;
bol,bolbar:boolean;
fs:F;
hs:H;
</span><span style="color: #0000ff;">begin</span><span style="color: #000000;">
     root.gridMethod:</span>=<span style="color: #800080;">0</span><span style="color: #000000;">;
     path:</span>=  pansiChar(AnsiString(<span style="color: #800000;">'</span><span style="color: #800000;">E:\123.txt</span><span style="color: #800000;">'</span><span style="color: #000000;">));
     root:</span>=<span style="color: #000000;"> RetRootobjectValues(path,res,mu);
</span><span style="color: #008000;">//</span><span style="color: #008000;">     resd:= root.WindDirectLine.coordinates^  ;</span><span style="color: #008000;">
//</span><span style="color: #008000;">     Mwind:=  root.WindDirectLine.coordinates^.mWindDirectBaseLine^;</span><span style="color: #008000;">
//</span><span style="color: #008000;">     Inc(root.WindDirectLine.coordinates);</span>
         bol:=<span style="color: #000000;">true;

            </span><span style="color: #0000ff;">while</span>(bol) <span style="color: #0000ff;">do</span>
            <span style="color: #0000ff;">begin</span><span style="color: #000000;">
               resd:</span>=<span style="color: #000000;"> root.WindDirectLine.coordinates^  ;
               </span><span style="color: #0000ff;">try</span><span style="color: #000000;">
                 Mwind:</span>=<span style="color: #000000;"> root.WindDirectLine.coordinates^.mWindDirectBaseLine^;
                 Mwbar:</span>=<span style="color: #000000;"> root.WindDirectLine.coordinates^.mWindDirectBars^;
                 fs:</span>=<span style="color: #000000;">Mwbar.f;
                 hs:</span>=<span style="color: #000000;">Mwbar.h;
                 hsf:</span>=<span style="color: #000000;"> fs.s;
                 hsh:</span>=<span style="color: #000000;">hs.s;

                 bolbar:</span>=<span style="color: #000000;">true;
                 mu:</span>=<span style="color: #000000;"> Mwind.s;

                 </span><span style="color: #0000ff;">while</span>((mu&lt;&gt;-<span style="color: #800080;">1414812757</span>)) <span style="color: #0000ff;">do</span>
                 <span style="color: #0000ff;">begin</span><span style="color: #000000;">
                  Inc(root.WindDirectLine.coordinates^.mWindDirectBaseLine); </span><span style="color: #008000;">{</span><span style="color: #008000;">到下一个</span><span style="color: #008000;">}</span><span style="color: #000000;">
                  Mwind:</span>=<span style="color: #000000;">  root.WindDirectLine.coordinates^.mWindDirectBaseLine^;
                  mu:</span>=<span style="color: #000000;"> Mwind.s;
                 </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;

                 </span><span style="color: #0000ff;">while</span>((hsf&lt;&gt;-<span style="color: #800080;">1414812757</span>) <span style="color: #0000ff;">and</span> (hsh&lt;&gt;-<span style="color: #800080;">1414812757</span>) ) <span style="color: #0000ff;">do</span>
                 <span style="color: #0000ff;">begin</span><span style="color: #000000;">
                   Inc(root.WindDirectLine.coordinates^.mWindDirectBars); </span><span style="color: #008000;">{</span><span style="color: #008000;">到下一个</span><span style="color: #008000;">}</span><span style="color: #000000;">

                      Mwbar:</span>=<span style="color: #000000;"> root.WindDirectLine.coordinates^.mWindDirectBars^;
                      fs:</span>=<span style="color: #000000;">Mwbar.f;
                      hs:</span>=<span style="color: #000000;">Mwbar.h;
                      hsf:</span>=<span style="color: #000000;"> fs.s;
                      hsh:</span>=<span style="color: #000000;">hs.s;

                 </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;
               </span><span style="color: #0000ff;">except</span>
               <span style="color: #0000ff;">begin</span><span style="color: #000000;">
                  bol:</span>=<span style="color: #000000;">false;
               </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;
               </span><span style="color: #0000ff;">end</span><span style="color: #000000;">;
               Inc(root.WindDirectLine.coordinates); </span><span style="color: #008000;">{</span><span style="color: #008000;">到下一个</span><span style="color: #008000;">}</span>
            <span style="color: #0000ff;">end</span><span style="color: #000000;">;


</span><span style="color: #008000;">//</span><span style="color: #008000;">     resd^:=root.WindDirectLine.coordinates;</span><span style="color: #008000;">
//</span><span style="color: #008000;">     Mwind[0]:=  resd.mWindDirectBaseLine;</span><span style="color: #008000;">
//</span><span style="color: #008000;">     Mwbar:=   resd.mWindDirectBars;</span><span style="color: #008000;">
//</span><span style="color: #008000;">      for I := 0 to 3 do</span><span style="color: #008000;">
//</span><span style="color: #008000;">      begin</span><span style="color: #008000;">
//</span><span style="color: #008000;">       resd:= root.WindDirectLine.coordinates;</span><span style="color: #008000;">
//
//</span><span style="color: #008000;">      end;</span>
<span style="color: #000000;">

     ShowMessage(root.gridStartTime);


</span><span style="color: #0000ff;">end</span>;</span></pre>
</div>
<span class="cnblogs_code_collapse" style="font-family: Microsoft YaHei;">Delphi调用方法</span></div>
<p>&nbsp;其中Json文件的读取运用了<a id="homepage1_HomePageDays_DaysList_ctl01_DayList_TitleUrl_0" class="postTitle2" href="https://www.cnblogs.com/motao9527/p/10749039.html">C++ Json解析CJsonObject的详细使用</a></p>
<p>代码中只展示了部分参数的赋值。</p>
<p>如果出现读取内存地址报错的情况，在C++的ReturnRootobject方法中添加 __stdcall。</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>